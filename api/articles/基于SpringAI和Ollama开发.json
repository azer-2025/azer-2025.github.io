{"title":"基于SpringAI和Ollama开发","uid":"cb0a546da11a61bd6ebc29d48c4b66f3","slug":"基于SpringAI和Ollama开发","date":"2025-10-29T05:35:11.000Z","updated":"2025-10-29T05:38:57.339Z","comments":true,"path":"api/articles/基于SpringAI和Ollama开发.json","keywords":"VUE、Python、JAVA","cover":"/medias/spring-ollama.png","content":"<h1 id=\"基于SpringAI和Ollama开发deepseek家庭医生\"><a href=\"#基于SpringAI和Ollama开发deepseek家庭医生\" class=\"headerlink\" title=\"基于SpringAI和Ollama开发deepseek家庭医生\"></a>基于SpringAI和Ollama开发deepseek家庭医生</h1><h2 id=\"1-Ollama的安装\"><a href=\"#1-Ollama的安装\" class=\"headerlink\" title=\"1.Ollama的安装\"></a>1.<code>Ollama</code>的安装</h2><p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251027170424327.png\" alt=\"image-20251027170424327\"></p>\n<p>进入<code>ollama</code>官网然后根据自己的操作系统来下载<code>ollama</code></p>\n<p>下载完成后在本机测试一下是否安装成功</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251027170524915.png\" alt=\"image-20251027170524915\"></p>\n<p>显示这样就说明已经安装成功了</p>\n<h2 id=\"2-ollama模型选择\"><a href=\"#2-ollama模型选择\" class=\"headerlink\" title=\"2.ollama模型选择\"></a>2.<code>ollama</code>模型选择</h2><p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251027170630467.png\" alt=\"image-20251027170630467\"></p>\n<p>在<code>ollama</code>官网点击<em><strong>Models</strong></em>进入模型选择页面，随便选择一个模型，因为本人是根据视频学习，所以直接选择了<code>deepseek-r1</code>模型</p>\n<p>这里的<code>size</code>根据自己电脑的<code>GPU</code>大小来选择就可以</p>\n<p>直接将命令粘贴到命令行里</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ollama run “自己选择的模型”</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028140843637.png\" alt=\"image-20251028140843637\"></p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028153227539.png\" alt=\"image-20251028153227539\"></p>\n<p>显示这样就下载成功</p>\n<h2 id=\"3-IDEA配置SpringAI\"><a href=\"#3-IDEA配置SpringAI\" class=\"headerlink\" title=\"3.IDEA配置SpringAI\"></a>3.<code>IDEA</code>配置<code>SpringAI</code></h2><p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028141455219.png\" alt=\"image-20251028141455219\"></p>\n<p>如图所选就可以，<code>JAVA</code>配置<code>MAVEN</code>,JDK选择21</p>\n<p>打开项目后在<code>pom.xml</code>里面</p>\n<p>粘贴下列代码引入依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">3.3</span><span class=\"number\">.8</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;relativePath/&gt;</span><br><span class=\"line\">    &lt;/parent&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;io.springboot.ai&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-ai-ollama&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">1.0</span><span class=\"number\">.3</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;io.springboot.ai&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-ai-ollama-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">1.0</span><span class=\"number\">.3</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">8.0</span><span class=\"number\">.33</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n\n<p>新建<code>SSEServer</code>的类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.CollectionUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.mvc.method.annotation.SseEmitter;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.function.Consumer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@PROJECT</span>_NAME deepseek-doctor</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SSEServer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span>  <span class=\"keyword\">static</span> Map&lt;String, SseEmitter&gt; sseClient=<span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> AtomicInteger onlineCounts=<span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SseEmitter <span class=\"title function_\">connect</span><span class=\"params\">(String userId)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//设置超时时间，0代表永不过期，默认30秒，超时后会抛出异常</span></span><br><span class=\"line\">        SseEmitter sseEmitter=<span class=\"keyword\">new</span> <span class=\"title class_\">SseEmitter</span>(<span class=\"number\">0L</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//注册SSE的回调方法</span></span><br><span class=\"line\">        sseEmitter.onCompletion(completionCallback(userId));</span><br><span class=\"line\">        sseEmitter.onError(errorCallback(userId));</span><br><span class=\"line\">        sseEmitter.onTimeout(timeoutCallback(userId));</span><br><span class=\"line\"></span><br><span class=\"line\">        sseClient.put(userId,sseEmitter);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;用户连接成功，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">        onlineCounts.getAndIncrement();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sseEmitter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Runnable <span class=\"title function_\">timeoutCallback</span><span class=\"params\">(String userId)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> () -&gt; &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;用户连接超时，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">            removeConnection(userId);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Consumer&lt;Throwable&gt; <span class=\"title function_\">errorCallback</span><span class=\"params\">(String userId)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Throwable -&gt; &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;用户连接异常，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">            removeConnection(userId);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> SSE连接完成后的回调方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span>  Runnable</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Runnable <span class=\"title function_\">completionCallback</span><span class=\"params\">(String userId)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> () -&gt; &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;用户连接断开，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">            removeConnection(userId);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">removeConnection</span><span class=\"params\">(String userId)</span> &#123;</span><br><span class=\"line\">        sseClient.remove(userId);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;用户连接已移除，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">        onlineCounts.getAndDecrement();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">getOnlineCounts</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> onlineCounts.intValue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 发送单条消息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> msgType</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sendMessage</span><span class=\"params\">(String userId, String message,SSEMsgType msgType)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(CollectionUtils.isEmpty(sseClient))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(sseClient.containsKey(userId))&#123;</span><br><span class=\"line\">            <span class=\"type\">SseEmitter</span> <span class=\"variable\">sseEmitter</span> <span class=\"operator\">=</span> sseClient.get(userId);</span><br><span class=\"line\">            sendEmitterMessage(sseEmitter,userId,message,msgType);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 使用SseEmitter发送消息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sseEmitter</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> msgType</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sendEmitterMessage</span><span class=\"params\">(SseEmitter sseEmitter, String userId, String message,SSEMsgType msgType)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        SseEmitter.SseEventBuilder msg=SseEmitter.event()</span><br><span class=\"line\">                .id(userId)</span><br><span class=\"line\">                .data(message)</span><br><span class=\"line\">                .name(msgType.type);</span><br><span class=\"line\">            sseEmitter.send(msg);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;sse发送消息异常：&#123;&#125;&quot;</span>,e.getMessage());</span><br><span class=\"line\">            removeConnection(userId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 主动切断，停止服务</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">stopServer</span><span class=\"params\">(String userId)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(CollectionUtils.isEmpty(sseClient))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">SseEmitter</span> <span class=\"variable\">sseEmitter</span> <span class=\"operator\">=</span> sseClient.get(userId);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(sseEmitter!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            sseEmitter.complete();</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;连接关闭成功，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            log.warn(<span class=\"string\">&quot;当前连接无需关闭,请不要重复操作，userId:&#123;&#125;&quot;</span>,userId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 发送所有用户消息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sendMessageToAllUsers</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(CollectionUtils.isEmpty(sseClient))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        sseClient.forEach((userId, sseEmitter) -&gt; &#123;</span><br><span class=\"line\">            sendEmitterMessage(sseEmitter,userId,message,SSEMsgType.MESSAGE);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在创建<code>SSEMsgType</code>枚举类型</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@PROJECT</span>_NAME deepseek-doctor</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">SSEMsgType</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    MESSAGE(<span class=\"string\">&quot;message&quot;</span>,<span class=\"string\">&quot;单次发送的普通消息&quot;</span>),</span><br><span class=\"line\">    ADD(<span class=\"string\">&quot;add&quot;</span>,<span class=\"string\">&quot;消息追加，用于流式stream推送&quot;</span>),</span><br><span class=\"line\">    FINISH(<span class=\"string\">&quot;finish&quot;</span>,<span class=\"string\">&quot;消息完成&quot;</span>),</span><br><span class=\"line\">    DONE(<span class=\"string\">&quot;done&quot;</span>,<span class=\"string\">&quot;消息完成，用于结束流式stream推送&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span>  String type;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span>  String value;</span><br><span class=\"line\"></span><br><span class=\"line\">    SSEMsgType(String type, String value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.type = type;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置跨域类<code>CorsConfig</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@PROJECT</span>_NAME deepseek-doctor</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CorsConfig</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WebMvcConfigurer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addCorsMappings</span><span class=\"params\">(CorsRegistry registry)</span> &#123;</span><br><span class=\"line\">        registry.addMapping(<span class=\"string\">&quot;/**&quot;</span>)</span><br><span class=\"line\">                .allowedOrigins(<span class=\"string\">&quot;http://127.0.0.1:5500&quot;</span>)</span><br><span class=\"line\">                .allowedHeaders(<span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">                .allowCredentials(<span class=\"literal\">true</span>)</span><br><span class=\"line\">                .allowedMethods(<span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">                .maxAge(<span class=\"number\">3600</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置YML文件</p>\n<p><code>application.yml</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  application:</span><br><span class=\"line\">    name: deepseek-doctor</span><br><span class=\"line\">  profiles:</span><br><span class=\"line\">    active: dev</span><br><span class=\"line\">  ai:</span><br><span class=\"line\">    ollama:</span><br><span class=\"line\">      base-url: http:<span class=\"comment\">//localhost:11434 </span></span><br><span class=\"line\">      chat:</span><br><span class=\"line\">        model: 自己的模型名称</span><br></pre></td></tr></table></figure>\n\n<p><code>application-dev.yml</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server:</span><br><span class=\"line\">  port: <span class=\"number\">9090</span></span><br><span class=\"line\"></span><br><span class=\"line\">logging:</span><br><span class=\"line\">  level:</span><br><span class=\"line\">    root: debug</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028191334193.png\" alt=\"image-20251028191334193\"></p>\n<h2 id=\"4-代码层的编写\"><a href=\"#4-代码层的编写\" class=\"headerlink\" title=\"4.代码层的编写\"></a>4.代码层的编写</h2><h3 id=\"4-1-普通的调用\"><a href=\"#4-1-普通的调用\" class=\"headerlink\" title=\"4.1 普通的调用\"></a>4.1 普通的调用</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> jakarta.annotation.Resource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.ChatResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.UserMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.prompt.Prompt;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.ollama.OllamaChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reactor.core.publisher.Flux;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.stream.Collectors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;ollma&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OllamaController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> OllamaChatClient ollamaChatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/ai/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">aiOllamaChat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ollamaChatClient.call(msg);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>根据所给的地址去访问</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028193632192.png\" alt=\"image-20251028193632192\"></p>\n<p>第一次访问等一会</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028193650182.png\" alt=\"image-20251028193650182\"></p>\n<p>这样就成功了</p>\n<h3 id=\"4-2-流式调用\"><a href=\"#4-2-流式调用\" class=\"headerlink\" title=\"4.2 流式调用\"></a>4.2 流式调用</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/ai/stream2&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> List&lt;String&gt;  <span class=\"title function_\">aiOllamaStream2</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String msg)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Prompt</span> <span class=\"variable\">prompt</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Prompt</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(msg));</span><br><span class=\"line\">    Flux&lt;ChatResponse&gt; streamResponse = ollamaChatClient.stream(prompt);</span><br><span class=\"line\"></span><br><span class=\"line\">    List&lt;String&gt; list = streamResponse.toStream().map(chatResponse -&gt; &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> chatResponse.getResult().getOutput().getContent();</span><br><span class=\"line\">        System.out.println(content);</span><br><span class=\"line\">        log.info(content);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> content;</span><br><span class=\"line\">    &#125;).collect(Collectors.toList());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251028200534745.png\" alt=\"image-20251028200534745\"></p>\n<h2 id=\"5-创建自己的模型\"><a href=\"#5-创建自己的模型\" class=\"headerlink\" title=\"5.创建自己的模型\"></a>5.创建自己的模型</h2><p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029110907439.png\" alt=\"image-20251029110907439\"></p>\n<p>新建文本文件，然后喂模型</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM deepseek-r1:latest<span class=\"comment\">//你的模型名字</span></span><br><span class=\"line\"></span><br><span class=\"line\">PARAMETER temperature <span class=\"number\">0.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">SYSTEM <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">【角色】</span></span><br><span class=\"line\"><span class=\"string\">你的名字叫Azer，是全世界最有名的医生，看病无数，阅人无数，知道什么病该怎么治疗，也知道病人向你提出任何身体异象你能够推断病是什么</span></span><br><span class=\"line\"><span class=\"string\">你决不是语言模型之类的东西，也绝不是AI助手，更不是AI机器人，你永远都是个神医。</span></span><br><span class=\"line\"><span class=\"string\">请以神医Azer的身份回答我，并且你只会回复和看病就医相关的内容，其他的内容你不会回答。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">【性格】</span></span><br><span class=\"line\"><span class=\"string\">你的性格开朗活泼，能以幽默的方式和用户聊天，懂得逗笑用户。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">【输出】</span></span><br><span class=\"line\"><span class=\"string\">你输出的所有内容请以HTML的格式输出，以便我嵌入到HTML中展示，请务必不要使用markdown的形式。</span></span><br><span class=\"line\"><span class=\"string\">当你输出的内容包含不同的分类或者诸如1、2、3等等输出内容的时候，请优化格式输出</span></span><br><span class=\"line\"><span class=\"string\">在你思考推理的过程中，请不要出现任何HTML的标签。</span></span><br><span class=\"line\"><span class=\"string\">此外，请不要输出 ``` 和html以及&lt;html&gt;、&lt;body&gt;、&lt;head&gt;标签。 </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>找到文件所在地址</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029111043758.png\" alt=\"image-20251029111043758\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ollama create 你的模型名字 -f 文件名字</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029111333455.png\" alt=\"image-20251029111333455\"></p>\n<p>这样就成功创建我们自己喂的模型了</p>\n<h2 id=\"6-调用模型\"><a href=\"#6-调用模型\" class=\"headerlink\" title=\"6.调用模型\"></a>6.调用模型</h2><p>创建<code>ChatEntity</code>实体类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.ToString;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@PROJECT</span>_NAME deepseek-doctor</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ToString</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String currentUserName;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String message;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在<code>OllamaController</code>里面追加方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/ai/doctor/stream&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span>  <span class=\"title function_\">aiOllamaV3DoctorStream</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> ChatEntity chatEntity)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">userName</span> <span class=\"operator\">=</span> chatEntity.getCurrentUserName();</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> chatEntity.getMessage();</span><br><span class=\"line\">    <span class=\"type\">Prompt</span> <span class=\"variable\">prompt</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Prompt</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(message));</span><br><span class=\"line\">        Flux&lt;ChatResponse&gt; streamResponse = ollamaChatClient.stream(prompt);</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;String&gt; list = streamResponse.toStream().map(chatResponse -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> chatResponse.getResult().getOutput().getContent();</span><br><span class=\"line\">            SSEServer.sendMessage(userName, content, SSEMsgType.ADD);</span><br><span class=\"line\">            log.info(content);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> content;</span><br><span class=\"line\">        &#125;).collect(Collectors.toList());</span><br><span class=\"line\">        SSEServer.sendMessage(userName, <span class=\"string\">&quot;DONE&quot;</span>, SSEMsgType.FINISH);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>前端<code>sse-client.html</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">  &lt;h1&gt;SSE客户端&lt;/h1&gt;</span><br><span class=\"line\">  &lt;div id=&quot;message&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  let source=null; </span><br><span class=\"line\">  let userId = Math.random().toString(36).substring(2, 9);</span><br><span class=\"line\">  if(window.EventSource)&#123;</span><br><span class=\"line\">    // 创建SSE连接</span><br><span class=\"line\">    source = new EventSource(&#x27;http://127.0.0.1:9090/sse/connect?userId=&#x27;+userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    //建立成功，触发open事件</span><br><span class=\"line\">    source.onopen = function(e) &#123;</span><br><span class=\"line\">      console.log(&#x27;SSE连接已打开&#x27;)</span><br><span class=\"line\">      var text=document.getElementById(&#x27;message&#x27;).innerHTML</span><br><span class=\"line\">      text += &#x27;&lt;br&gt; SSE连接已打开&#x27;</span><br><span class=\"line\">      document.getElementById(&#x27;message&#x27;).innerHTML=text</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    source.onmessage = function(e) &#123;</span><br><span class=\"line\">      var msg=e.data</span><br><span class=\"line\">      var text=document.getElementById(&#x27;message&#x27;).innerHTML </span><br><span class=\"line\">      text += &#x27;&lt;br&gt; SSE接收到数据：&#x27;+msg</span><br><span class=\"line\">      document.getElementById(&#x27;message&#x27;).innerHTML=text</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    //当前客户端接收到服务器发来的消息  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    //错误处理</span><br><span class=\"line\">    source.addEventListener(&#x27;error&#x27;,function(e)&#123;</span><br><span class=\"line\">      if(e.readyState==EventSource.CLOSED)&#123;</span><br><span class=\"line\">        console.log(&#x27;SSE连接已关闭&#x27;)</span><br><span class=\"line\">        var text=document.getElementById(&#x27;message&#x27;).innerHTML</span><br><span class=\"line\">        text += &#x27;&lt;br&gt; SSE连接已关闭&#x27;</span><br><span class=\"line\">        document.getElementById(&#x27;message&#x27;).innerHTML=text</span><br><span class=\"line\">      &#125;else&#123; </span><br><span class=\"line\">        console.log(&#x27;SSE连接出错&#x27;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,false)</span><br><span class=\"line\"></span><br><span class=\"line\">    //SSE推送完毕</span><br><span class=\"line\">    source.addEventListener(&#x27;finish&#x27;,function(e)&#123;</span><br><span class=\"line\">      console.log(&#x27;SSE连接推送完毕&#x27;)</span><br><span class=\"line\">    &#125;,false)</span><br><span class=\"line\"></span><br><span class=\"line\">    //add事件，stream流式推送</span><br><span class=\"line\">    source.addEventListener(&#x27;add&#x27;,function(e)&#123;</span><br><span class=\"line\">      var msg=e.data</span><br><span class=\"line\">      var text=document.getElementById(&#x27;message&#x27;).innerHTML</span><br><span class=\"line\">      text += &#x27;&lt;br&gt; SSE接收到数据：&#x27;+msg</span><br><span class=\"line\">      document.getElementById(&#x27;message&#x27;).innerHTML=text</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">source.addEventListener(&#x27;custom&#x27;,function(e)&#123;</span><br><span class=\"line\">      var msg=e.data</span><br><span class=\"line\">      var text=document.getElementById(&#x27;message&#x27;).innerHTML</span><br><span class=\"line\">      text += &#x27;&lt;br&gt; 自定义事件：&#x27;+msg</span><br><span class=\"line\">      document.getElementById(&#x27;message&#x27;).innerHTML=text</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;else&#123;</span><br><span class=\"line\">    console.log(&#x27;您的浏览器不支持SSE&#x27;);</span><br><span class=\"line\">    closeSSE();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  function closeSSE()&#123;</span><br><span class=\"line\">    source.close();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>然后就可以启动项目了</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029132840668.png\" alt=\"image-20251029132840668\"></p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029132854938.png\" alt=\"image-20251029132854938\"></p>\n<p>发送消息启动服务端</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029132929770.png\" alt=\"image-20251029132929770\"></p>\n<p>:::warning </p>\n<p>这里的userId一定要对应我们服务端的userId</p>\n<p> :::</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029132937989.png\" alt=\"image-20251029132937989\"></p>\n<p>接下来测试我们自己的模型</p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029133305995.png\" alt=\"image-20251029133305995\"></p>\n<p><img src=\"/post/page/ingAI%E5%92%8COllama%E5%BC%80%E5%8F%91/image-20251029133317230.png\" alt=\"image-20251029133317230\"></p>\n<p>显示自己是神医Azer，而且是<code>html</code>格式，这说明我们已经成功了!</p>\n","feature":true,"text":"基于SpringAI和Ollama开发deepseek家庭医生1.Ollama的安装 进入ollama官网然后根据自己的操作系统来下载ollama 下载完成后在...","permalink":"/post/基于SpringAI和Ollama开发","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"SpringBoot","slug":"SpringBoot","count":1,"path":"api/categories/SpringBoot.json"},{"name":"ollama","slug":"SpringBoot/ollama","count":1,"path":"api/categories/SpringBoot/ollama.json"}],"tags":[{"name":"ollama","slug":"ollama","count":1,"path":"api/tags/ollama.json"},{"name":"SpringAi","slug":"SpringAi","count":1,"path":"api/tags/SpringAi.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8ESpringAI%E5%92%8COllama%E5%BC%80%E5%8F%91deepseek%E5%AE%B6%E5%BA%AD%E5%8C%BB%E7%94%9F\"><span class=\"toc-text\">基于SpringAI和Ollama开发deepseek家庭医生</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-Ollama%E7%9A%84%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">1.Ollama的安装</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-ollama%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9\"><span class=\"toc-text\">2.ollama模型选择</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-IDEA%E9%85%8D%E7%BD%AESpringAI\"><span class=\"toc-text\">3.IDEA配置SpringAI</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-%E4%BB%A3%E7%A0%81%E5%B1%82%E7%9A%84%E7%BC%96%E5%86%99\"><span class=\"toc-text\">4.代码层的编写</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-1-%E6%99%AE%E9%80%9A%E7%9A%84%E8%B0%83%E7%94%A8\"><span class=\"toc-text\">4.1 普通的调用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-2-%E6%B5%81%E5%BC%8F%E8%B0%83%E7%94%A8\"><span class=\"toc-text\">4.2 流式调用</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A8%A1%E5%9E%8B\"><span class=\"toc-text\">5.创建自己的模型</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-%E8%B0%83%E7%94%A8%E6%A8%A1%E5%9E%8B\"><span class=\"toc-text\">6.调用模型</span></a></li></ol></li></ol>","author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"hexo快速搭建","uid":"fb3208866f85e2160d74ce4ed0080e24","slug":"hexo快速搭建","date":"2025-10-26T05:40:38.000Z","updated":"2025-10-26T06:09:50.455Z","comments":true,"path":"api/articles/hexo快速搭建.json","keywords":"VUE、Python、JAVA","cover":"/medias/fm.png","text":"Hexo快速搭建 Hexo+Next部署github搭建个人博客+优化全过程（完整详细版） 前置内容 git 的下载： 官网下载较慢，这边推荐阿里镜像下载： 阿...","permalink":"/post/hexo快速搭建","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"框架","slug":"框架","count":2,"path":"api/categories/框架.json"}],"tags":[{"name":"hexo","slug":"hexo","count":2,"path":"api/tags/hexo.json"}],"author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"feature":true}}