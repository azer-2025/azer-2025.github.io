{"title":"Sa-Token权限校验","uid":"0b114f94280493e69340137c35c865bf","slug":"Sa-Token权限校验","date":"2025-12-12T10:12:47.000Z","updated":"2025-12-12T10:20:48.758Z","comments":true,"path":"api/articles/Sa-Token权限校验.json","keywords":"VUE、Python、JAVA","cover":"/medias/satoken.png","content":"<hr>\n<h3 id=\"1、设计思路\"><a href=\"#1、设计思路\" class=\"headerlink\" title=\"1、设计思路\"></a>1、设计思路</h3><p>所谓权限认证，核心逻辑就是判断一个账号是否拥有指定权限：</p>\n<ul>\n<li>有，就让你通过。</li>\n<li>没有？那么禁止访问！</li>\n</ul>\n<p>深入到底层数据中，就是每个账号都会拥有一组权限码集合，框架来校验这个集合中是否包含指定的权限码。</p>\n<p>例如：当前账号拥有权限码集合 <code>[&quot;user-add&quot;, &quot;user-delete&quot;, &quot;user-get&quot;]</code>，这时候我来校验权限 <code>&quot;user-update&quot;</code>，则其结果就是：<strong>验证失败，禁止访问</strong>。</p>\n<p><img src=\"/post/Sa-Token%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/g3--jur-auth.gif\" alt=\"g3--jur-auth\"></p>\n<p>所以现在问题的核心就是两个：</p>\n<ol>\n<li><p>如何获取一个账号所拥有的权限码集合？</p>\n</li>\n<li><p>本次操作需要验证的权限码是哪个？</p>\n<p>数据库文件</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> Navicat Premium Data Transfer</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> Source Server         : MySQL</span></span><br><span class=\"line\"><span class=\"comment\"> Source Server Type    : MySQL</span></span><br><span class=\"line\"><span class=\"comment\"> Source Server Version : 80033</span></span><br><span class=\"line\"><span class=\"comment\"> Source Host           : localhost:3306</span></span><br><span class=\"line\"><span class=\"comment\"> Source Schema         : satoken_db</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> Target Server Type    : MySQL</span></span><br><span class=\"line\"><span class=\"comment\"> Target Server Version : 80033</span></span><br><span class=\"line\"><span class=\"comment\"> File Encoding         : 65001</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SET</span> NAMES utf8mb4;</span><br><span class=\"line\"><span class=\"keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Table structure for user</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> `<span class=\"keyword\">user</span>`;</span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> `<span class=\"keyword\">user</span>`  (</span><br><span class=\"line\">  `id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;用户ID&#x27;</span>,</span><br><span class=\"line\">  `username` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">CHARACTER SET</span> utf8mb4 <span class=\"keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;用户名&#x27;</span>,</span><br><span class=\"line\">  `password` <span class=\"type\">varchar</span>(<span class=\"number\">100</span>) <span class=\"keyword\">CHARACTER SET</span> utf8mb4 <span class=\"keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;密码&#x27;</span>,</span><br><span class=\"line\">  `role_id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;角色ID&#x27;</span>,</span><br><span class=\"line\">  `create_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\">  `update_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> <span class=\"keyword\">ON</span> <span class=\"keyword\">UPDATE</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;更新时间&#x27;</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`id`) <span class=\"keyword\">USING</span> BTREE,</span><br><span class=\"line\">  <span class=\"keyword\">UNIQUE</span> INDEX `uk_username`(`username` <span class=\"keyword\">ASC</span>) <span class=\"keyword\">USING</span> BTREE</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB <span class=\"keyword\">CHARACTER SET</span> <span class=\"operator\">=</span> utf8mb4 <span class=\"keyword\">COLLATE</span> <span class=\"operator\">=</span> utf8mb4_0900_ai_ci COMMENT <span class=\"operator\">=</span> <span class=\"string\">&#x27;用户表&#x27;</span> ROW_FORMAT <span class=\"operator\">=</span> <span class=\"keyword\">Dynamic</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Table structure for role</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> `role`;</span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> `role`  (</span><br><span class=\"line\">  `id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;角色ID&#x27;</span>,</span><br><span class=\"line\">  `name` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">CHARACTER SET</span> utf8mb4 <span class=\"keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;角色名称&#x27;</span>,</span><br><span class=\"line\">  `description` <span class=\"type\">varchar</span>(<span class=\"number\">200</span>) <span class=\"keyword\">CHARACTER SET</span> utf8mb4 <span class=\"keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span> COMMENT <span class=\"string\">&#x27;角色描述&#x27;</span>,</span><br><span class=\"line\">  `create_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\">  `update_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> <span class=\"keyword\">ON</span> <span class=\"keyword\">UPDATE</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;更新时间&#x27;</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`id`) <span class=\"keyword\">USING</span> BTREE,</span><br><span class=\"line\">  <span class=\"keyword\">UNIQUE</span> INDEX `uk_name`(`name` <span class=\"keyword\">ASC</span>) <span class=\"keyword\">USING</span> BTREE</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB <span class=\"keyword\">CHARACTER SET</span> <span class=\"operator\">=</span> utf8mb4 <span class=\"keyword\">COLLATE</span> <span class=\"operator\">=</span> utf8mb4_0900_ai_ci COMMENT <span class=\"operator\">=</span> <span class=\"string\">&#x27;角色表&#x27;</span> ROW_FORMAT <span class=\"operator\">=</span> <span class=\"keyword\">Dynamic</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Table structure for permission</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> `permission`;</span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> `permission`  (</span><br><span class=\"line\">  `id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;权限ID&#x27;</span>,</span><br><span class=\"line\">  `name` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">CHARACTER SET</span> utf8mb4 <span class=\"keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;权限名称&#x27;</span>,</span><br><span class=\"line\">  `description` <span class=\"type\">varchar</span>(<span class=\"number\">200</span>) <span class=\"keyword\">CHARACTER SET</span> utf8mb4 <span class=\"keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span> COMMENT <span class=\"string\">&#x27;权限描述&#x27;</span>,</span><br><span class=\"line\">  `create_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\">  `update_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> <span class=\"keyword\">ON</span> <span class=\"keyword\">UPDATE</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;更新时间&#x27;</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`id`) <span class=\"keyword\">USING</span> BTREE,</span><br><span class=\"line\">  <span class=\"keyword\">UNIQUE</span> INDEX `uk_name`(`name` <span class=\"keyword\">ASC</span>) <span class=\"keyword\">USING</span> BTREE</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB <span class=\"keyword\">CHARACTER SET</span> <span class=\"operator\">=</span> utf8mb4 <span class=\"keyword\">COLLATE</span> <span class=\"operator\">=</span> utf8mb4_0900_ai_ci COMMENT <span class=\"operator\">=</span> <span class=\"string\">&#x27;权限表&#x27;</span> ROW_FORMAT <span class=\"operator\">=</span> <span class=\"keyword\">Dynamic</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Table structure for role_permission</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> `role_permission`;</span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> `role_permission`  (</span><br><span class=\"line\">  `id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;主键ID&#x27;</span>,</span><br><span class=\"line\">  `role_id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;角色ID&#x27;</span>,</span><br><span class=\"line\">  `permission_id` <span class=\"type\">bigint</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;权限ID&#x27;</span>,</span><br><span class=\"line\">  `create_time` datetime <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span> COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`id`) <span class=\"keyword\">USING</span> BTREE,</span><br><span class=\"line\">  <span class=\"keyword\">UNIQUE</span> INDEX `uk_role_permission`(`role_id` <span class=\"keyword\">ASC</span>, `permission_id` <span class=\"keyword\">ASC</span>) <span class=\"keyword\">USING</span> BTREE</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB <span class=\"keyword\">CHARACTER SET</span> <span class=\"operator\">=</span> utf8mb4 <span class=\"keyword\">COLLATE</span> <span class=\"operator\">=</span> utf8mb4_0900_ai_ci COMMENT <span class=\"operator\">=</span> <span class=\"string\">&#x27;角色权限关联表&#x27;</span> ROW_FORMAT <span class=\"operator\">=</span> <span class=\"keyword\">Dynamic</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Records of role</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role` <span class=\"keyword\">VALUES</span> (<span class=\"number\">1</span>, <span class=\"string\">&#x27;ADMIN&#x27;</span>, <span class=\"string\">&#x27;管理员&#x27;</span>, NOW(), NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role` <span class=\"keyword\">VALUES</span> (<span class=\"number\">2</span>, <span class=\"string\">&#x27;USER&#x27;</span>, <span class=\"string\">&#x27;普通用户&#x27;</span>, NOW(), NOW());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Records of permission</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">1</span>, <span class=\"string\">&#x27;USER_VIEW&#x27;</span>, <span class=\"string\">&#x27;查看用户列表&#x27;</span>, NOW(), NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">2</span>, <span class=\"string\">&#x27;USER_ADD&#x27;</span>, <span class=\"string\">&#x27;添加用户&#x27;</span>, NOW(), NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">3</span>, <span class=\"string\">&#x27;USER_EDIT&#x27;</span>, <span class=\"string\">&#x27;编辑用户&#x27;</span>, NOW(), NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">4</span>, <span class=\"string\">&#x27;USER_DELETE&#x27;</span>, <span class=\"string\">&#x27;删除用户&#x27;</span>, NOW(), NOW());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Records of role_permission</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- 管理员拥有所有权限</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role_permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role_permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role_permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>, NOW());</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role_permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">4</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>, NOW());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 普通用户只有查看权限</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `role_permission` <span class=\"keyword\">VALUES</span> (<span class=\"number\">5</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>, NOW());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Records of user</span></span><br><span class=\"line\"><span class=\"comment\">-- ----------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- 管理员用户</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `<span class=\"keyword\">user</span>` <span class=\"keyword\">VALUES</span> (<span class=\"number\">1</span>, <span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;admin123&#x27;</span>, <span class=\"number\">1</span>, NOW(), NOW());</span><br><span class=\"line\"><span class=\"comment\">-- 普通用户</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `<span class=\"keyword\">user</span>` <span class=\"keyword\">VALUES</span> (<span class=\"number\">2</span>, <span class=\"string\">&#x27;user&#x27;</span>, <span class=\"string\">&#x27;user123&#x27;</span>, <span class=\"number\">2</span>, NOW(), NOW());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"2、获取当前账号权限码集合\"><a href=\"#2、获取当前账号权限码集合\" class=\"headerlink\" title=\"2、获取当前账号权限码集合\"></a>2、获取当前账号权限码集合</h3><p>因为每个项目的需求不同，其权限设计也千变万化，因此 [ 获取当前账号权限码集合 ] 这一操作不可能内置到框架中， 所以 Sa-Token 将此操作以接口的方式暴露给你，以方便你根据自己的业务逻辑进行重写。</p>\n<p>你需要做的就是新建一个类，实现 <code>StpInterface</code>接口，例如以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 自定义权限验证接口扩展</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SaTokenPermissionConfig</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">StpInterface</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> PermissionService permissionService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RoleService roleService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回一个用户所拥有的权限集合</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">getPermissionList</span><span class=\"params\">(Object loginId, String loginType)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取用户信息</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getById(Long.valueOf(loginId.toString()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取用户角色对应的权限列表</span></span><br><span class=\"line\">        List&lt;Permission&gt; permissions = permissionService.getPermissionsByRoleId(user.getRoleId());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 提取权限名称</span></span><br><span class=\"line\">        List&lt;String&gt; permissionNames = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Permission permission : permissions) &#123;</span><br><span class=\"line\">            permissionNames.add(permission.getName());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> permissionNames;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回一个用户所拥有的角色标识集合</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">getRoleList</span><span class=\"params\">(Object loginId, String loginType)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取用户信息</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getById(Long.valueOf(loginId.toString()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取角色信息</span></span><br><span class=\"line\">        <span class=\"type\">Role</span> <span class=\"variable\">role</span> <span class=\"operator\">=</span> roleService.getById(user.getRoleId());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将角色名称作为角色标识返回</span></span><br><span class=\"line\">        List&lt;String&gt; roleNames = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        roleNames.add(role.getName());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> roleNames;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>参数解释：</strong></p>\n<ul>\n<li>loginId：账号id，即你在调用 <code>StpUtil.login(id)</code> 时写入的标识值。</li>\n<li>loginType：账号体系标识，此处可以暂时忽略。</li>\n</ul>\n<h3 id=\"3、注册拦截器\"><a href=\"#3、注册拦截器\" class=\"headerlink\" title=\"3、注册拦截器\"></a>3、注册拦截器</h3><p>以<code>SpringBoot2.0</code>为例，新建配置类<code>SaTokenConfigure.java</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SaTokenConfigure</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WebMvcConfigurer</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 注册 Sa-Token 拦截器，打开注解式鉴权功能 </span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addInterceptors</span><span class=\"params\">(InterceptorRegistry registry)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 注册 Sa-Token 拦截器，打开注解式鉴权功能 </span></span><br><span class=\"line\">        registry.addInterceptor(<span class=\"keyword\">new</span> <span class=\"title class_\">SaInterceptor</span>()).addPathPatterns(<span class=\"string\">&quot;/**&quot;</span>);    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;复制到剪贴板错误复制成功</span><br></pre></td></tr></table></figure>\n\n<p>保证此类被<code>springboot</code>启动类扫描到即可</p>\n<h3 id=\"4、使用注解鉴权\"><a href=\"#4、使用注解鉴权\" class=\"headerlink\" title=\"4、使用注解鉴权\"></a>4、使用注解鉴权</h3><p>然后我们就可以愉快的使用注解鉴权了：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用户管理控制器</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RoleService roleService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取用户列表 (需要USER_VIEW权限)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 用户列表</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@SaCheckPermission(&quot;USER_VIEW&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/list&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">getUserList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 从数据库查询用户列表</span></span><br><span class=\"line\">        List&lt;User&gt; userList = userService.list();</span><br><span class=\"line\"></span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;获取成功&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;data&quot;</span>, userList);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 分页获取用户列表 (需要USER_VIEW权限)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> pageNum 当前页码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> pageSize 每页条数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 用户列表</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@SaCheckPermission(&quot;USER_VIEW&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/page&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">getUserPage</span><span class=\"params\">(<span class=\"meta\">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer pageNum,</span></span><br><span class=\"line\"><span class=\"params\">                                          <span class=\"meta\">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer pageSize)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 分页查询用户列表</span></span><br><span class=\"line\">        Page&lt;User&gt; page = <span class=\"keyword\">new</span> <span class=\"title class_\">Page</span>&lt;&gt;(pageNum, pageSize);</span><br><span class=\"line\">        Page&lt;User&gt; userPage = userService.page(page);</span><br><span class=\"line\"></span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;获取成功&quot;</span>);</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">&quot;records&quot;</span>, userPage.getRecords());</span><br><span class=\"line\">        data.put(<span class=\"string\">&quot;total&quot;</span>, userPage.getTotal());</span><br><span class=\"line\">        data.put(<span class=\"string\">&quot;current&quot;</span>, userPage.getCurrent());</span><br><span class=\"line\">        data.put(<span class=\"string\">&quot;size&quot;</span>, userPage.getSize());</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;data&quot;</span>, data);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据ID获取用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id 用户ID</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/info/&#123;id&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">getUserInfo</span><span class=\"params\">(<span class=\"meta\">@PathVariable</span> Long id)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getById(id);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取角色名称</span></span><br><span class=\"line\">            <span class=\"type\">Role</span> <span class=\"variable\">role</span> <span class=\"operator\">=</span> roleService.getById(user.getRoleId());</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">roleName</span> <span class=\"operator\">=</span> role != <span class=\"literal\">null</span> ? role.getName() : <span class=\"string\">&quot;未知角色&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;获取成功&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;data&quot;</span>, user);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;roleName&quot;</span>, roleName); <span class=\"comment\">// 添加角色名称</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">404</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;用户不存在&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加用户 (需要USER_ADD权限)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user 用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 添加结果</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@SaCheckPermission(&quot;USER_ADD&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/add&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">addUser</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> User user)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 检查用户名是否已存在</span></span><br><span class=\"line\">        QueryWrapper&lt;User&gt; queryWrapper = <span class=\"keyword\">new</span> <span class=\"title class_\">QueryWrapper</span>&lt;&gt;();</span><br><span class=\"line\">        queryWrapper.eq(<span class=\"string\">&quot;username&quot;</span>, user.getUsername());</span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">existingUser</span> <span class=\"operator\">=</span> userService.getOne(queryWrapper);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existingUser != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;用户名已存在&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 插入用户数据</span></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> userService.save(user);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;添加成功&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;data&quot;</span>, user);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;添加失败&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 编辑用户 (需要USER_EDIT权限)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user 用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 编辑结果</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@SaCheckPermission(&quot;USER_EDIT&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@PutMapping(&quot;/edit&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">editUser</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> User user)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 更新用户数据</span></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> userService.updateById(user);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;编辑成功&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;data&quot;</span>, user);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;编辑失败&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除用户 (需要USER_DELETE权限)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id 用户ID</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 删除结果</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@SaCheckPermission(&quot;USER_DELETE&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@DeleteMapping(&quot;/delete/&#123;id&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">deleteUser</span><span class=\"params\">(<span class=\"meta\">@PathVariable</span> Long id)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 删除用户数据</span></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> userService.removeById(id);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (success) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;删除成功&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;data&quot;</span>, id);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;删除失败&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、如何把权限精确到按钮级？\"><a href=\"#5、如何把权限精确到按钮级？\" class=\"headerlink\" title=\"5、如何把权限精确到按钮级？\"></a>5、如何把权限精确到按钮级？</h3><p>权限精确到按钮级的意思就是指：<strong>权限范围可以控制到页面上的每一个按钮是否显示</strong>。</p>\n<p>思路：如此精确的范围控制只依赖后端已经难以完成，此时需要前端进行一定的逻辑判断。s</p>\n<p>如果是前后端一体项目，可以参考：<a href=\"https://sa-token.cc/doc.html#/plugin/thymeleaf-extend\">Thymeleaf 标签方言</a>，如果是前后端分离项目，则：</p>\n<ol>\n<li><p>在登录时，把当前账号拥有的所有权限码一次性返回给前端。</p>\n</li>\n<li><p>前端将权限码集合保存在<code>localStorage</code>或其它全局状态管理对象中。</p>\n</li>\n<li><p>在需要权限控制的按钮上，使用 js 进行逻辑判断，例如在<code>vue</code>框架中我们可以使用如下写法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// `arr`是当前用户拥有的权限码数组</span></span><br><span class=\"line\"><span class=\"comment\">// `user.delete`是显示按钮需要拥有的权限码</span></span><br><span class=\"line\"><span class=\"comment\">// `删除按钮`是用户拥有权限码才可以看到的内容。</span></span><br><span class=\"line\">&lt;button v-<span class=\"keyword\">if</span>=<span class=\"string\">&quot;arr.indexOf(&#x27;user.delete&#x27;) &gt; -1&quot;</span>&gt;删除按钮&lt;/button&gt;复制到剪贴板错误复制成功</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>以上写法只为提供一个参考示例，不同框架有不同写法，大家可根据项目技术栈灵活封装进行调用。</p>\n<p>前端有了鉴权后端还需要鉴权吗？</p>\n<p><strong>需要！</strong><br>前端的鉴权只是一个辅助功能，对于专业人员这些限制都是可以轻松绕过的，为保证服务器安全：<strong>无论前端是否进行了权限校验，后端接口都需要对会话请求再次进行权限校验！</strong></p>\n","feature":true,"text":" 1、设计思路所谓权限认证，核心逻辑就是判断一个账号是否拥有指定权限： 有，就让你通过。 没有？那么禁止访问！ 深入到底层数据中，就是每个账号都会拥有一组权限码...","permalink":"/post/Sa-Token权限校验","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"对象存储","slug":"对象存储","count":4,"path":"api/categories/对象存储.json"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","count":7,"path":"api/tags/SpringBoot.json"},{"name":"Java","slug":"Java","count":7,"path":"api/tags/Java.json"},{"name":"权限","slug":"权限","count":1,"path":"api/tags/权限.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1%E3%80%81%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">1、设计思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%B4%A6%E5%8F%B7%E6%9D%83%E9%99%90%E7%A0%81%E9%9B%86%E5%90%88\"><span class=\"toc-text\">2、获取当前账号权限码集合</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3%E3%80%81%E6%B3%A8%E5%86%8C%E6%8B%A6%E6%88%AA%E5%99%A8\"><span class=\"toc-text\">3、注册拦截器</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4%E3%80%81%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E9%89%B4%E6%9D%83\"><span class=\"toc-text\">4、使用注解鉴权</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5%E3%80%81%E5%A6%82%E4%BD%95%E6%8A%8A%E6%9D%83%E9%99%90%E7%B2%BE%E7%A1%AE%E5%88%B0%E6%8C%89%E9%92%AE%E7%BA%A7%EF%BC%9F\"><span class=\"toc-text\">5、如何把权限精确到按钮级？</span></a></li></ol>","author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"阿里云AI扩图","uid":"af0ea2a5dd8fabab515520a49ab3cbc6","slug":"阿里云AI扩图","date":"2025-12-09T01:35:56.000Z","updated":"2025-12-09T02:19:13.952Z","comments":true,"path":"api/articles/阿里云AI扩图.json","keywords":"VUE、Python、JAVA","cover":"/medias/aliai.png","text":"1、官方介绍通过阅读 官方文档，发现它是支持 AI 图像编辑与生成功能的，包括 AI 扩图，支持 HTTP 调用，符合我们的需求。 在 控制台 也能看到对应的图...","permalink":"/post/阿里云AI扩图","photos":[],"count_time":{"symbolsCount":"21k","symbolsTime":"19 mins."},"categories":[{"name":"对象存储","slug":"对象存储","count":4,"path":"api/categories/对象存储.json"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","count":7,"path":"api/tags/SpringBoot.json"},{"name":"Java","slug":"Java","count":7,"path":"api/tags/Java.json"},{"name":"插件","slug":"插件","count":7,"path":"api/tags/插件.json"}],"author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"feature":true}}