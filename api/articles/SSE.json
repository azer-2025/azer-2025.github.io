{"title":"SSE","uid":"6f3bec25b72da0f2f917f80df8077d15","slug":"SSE","date":"2025-11-13T03:29:48.000Z","updated":"2025-11-13T05:07:41.712Z","comments":true,"path":"api/articles/SSE.json","keywords":"VUE、Python、JAVA","cover":"/medias/SSE.png","content":"<h1 id=\"一、什么是SSE？SSE为何突然爆火？\"><a href=\"#一、什么是SSE？SSE为何突然爆火？\" class=\"headerlink\" title=\"一、什么是SSE？SSE为何突然爆火？\"></a>一、什么是SSE？SSE为何突然爆火？</h1><p>你有没有想过，为什么 ChatGPT 的回答能逐字逐句地“流”出来？</p>\n<p>这一切的背后，都离不开一项关键技术——<strong>SSE（Server-Sent Events）</strong>！</p>\n<h2 id=\"1-1、什么是-SSE？\"><a href=\"#1-1、什么是-SSE？\" class=\"headerlink\" title=\"1.1、什么是 SSE？\"></a>1.1、什么是 SSE？</h2><p>SSE（Server-Sent Events）是一种基于 HTTP 协议的<strong>服务器推送技术</strong>，允许服务端主动向客户端发送数据流。</p>\n<p><strong>SSE 可以被理解为 HTTP 的一个扩展或一种特定用法。它不是一个全新的、独立的协议，而是构建在标准 HTTP&#x2F;1.1 协议之上的技术。</strong></p>\n<p>SSE 就像是服务器打开了一个“单向数据管道”，服务器通过HTTP 扩展 可以持续不断地流向浏览器，无需客户端反复发起请求。</p>\n<p>其实很简单的： SSE &#x3D; HTTP 扩展字段 + Keepalive 长连接。</p>\n<p>SSE 提供了一种简单、可靠的方式来实现服务器向客户端的实时数据推送。它非常适合通知、实时数据更新、日志流和类似 ChatGPT 的逐字输出场景。如果你只需要单向通信，SSE 往往是比 WebSocket 更简单、更轻量的选择。</p>\n<p>SSE 适用于服务器主动向客户端推送数据的场景，如实时通知、动态更新等。</p>\n<p>所以，目前 几乎所有主流浏览器都原生支持SSE。</p>\n<h2 id=\"1-2-SSE-Server-Sent-Events-诞生背景\"><a href=\"#1-2-SSE-Server-Sent-Events-诞生背景\" class=\"headerlink\" title=\"1.2 SSE (Server-Sent Events) 诞生背景\"></a>1.2 SSE (Server-Sent Events) 诞生背景</h2><h3 id=\"短轮询、长轮询、Flash-、-WebSocket\"><a href=\"#短轮询、长轮询、Flash-、-WebSocket\" class=\"headerlink\" title=\"短轮询、长轮询、Flash 、 WebSocket\"></a>短轮询、长轮询、Flash 、 WebSocket</h3><p>在 SSE 技术出现之前，Web 应用要实现服务器向客户端的实时数据推送，主要依赖以下几种技术，但它们都存在明显的缺陷：</p>\n<p>1、 <strong>短轮询 (Polling)</strong>:</p>\n<ul>\n<li><strong>原理</strong>：客户端以固定的时间间隔（例如每秒一次）频繁地向服务器发送请求，询问是否有新数据。</li>\n<li><strong>缺点</strong>：大量请求可能是无效的（无新数据），浪费服务器和带宽资源，实时性差。</li>\n</ul>\n<p><strong>短轮询 的流程图</strong></p>\n<p><img src=\"/post/SSE/7c3d97f93ae341888621ae5406c7a0c4.png\" alt=\"Image 15: Mermaid\"></p>\n<p>2、 <strong>长轮询 (Long Polling)</strong>:</p>\n<ul>\n<li><strong>原理</strong>：使用长连接请求数据。 客户端发送一个请求，服务器会保持这个连接打开（长连接），直到有新数据可用或超时。一旦客户端收到响应，会立即发起下一个请求。</li>\n<li><strong>缺点</strong>：虽然减少了无效请求，但每个连接仍然需要客户端发起，服务器需要维护大量挂起的连接，实现复杂。</li>\n</ul>\n<p><img src=\"/post/SSE/74bafe0add5e4d6ea786f8eb9cf95852.png\" alt=\"Image 16: Mermaid\"></p>\n<p>长轮询 (Long Polling) 突破：减少无效请求，但服务器需维护挂起连接</p>\n<p>3、 <strong>基于 Flash 的解决方案</strong>:</p>\n<ul>\n<li><strong>原理</strong>：利用 Adobe Flash 插件提供的 Socket 功能实现全双工通信。</li>\n<li><strong>缺点</strong>：依赖浏览器插件，在移动端（如 iPhone）不受支持，且随着技术的发展（Flash 被淘汰）已走向消亡。基于 Flash 方法都非原生支持，效率低下或依赖外部插件。</li>\n</ul>\n<p>4、 <strong>基于 WebSocket的解决方案</strong>:</p>\n<ul>\n<li><strong>原理</strong>：在客户端与服务器之间建立一条全双工的 TCP 长连接，双方可随时互相推送数据。</li>\n<li><strong>缺点</strong>： 需要一次额外的协议升级握手（<code>Upgrade: websocket</code>），对 CDN、防火墙、代理服务器的兼容性不如普通 HTTP； 双向通信能力在“服务器→客户端单向推送”场景下显得过度设计，增加心跳、重连、帧解析等复杂度；早期浏览器支持不一（IE ≤ 9 无原生实现），需要 Polyfill 或 Flash 降级方案。</li>\n</ul>\n<p><img src=\"/post/SSE/aa5e2f8ca644490399717a6c5134bf4d.png\" alt=\"Image 17: Mermaid\"></p>\n<p>WebSocket：全双工通道 革命性：摆脱HTTP束缚，实现真 实时交互</p>\n<p>WebSocket 并不是 Web 领域 的通讯协议，属于复杂度高 二进制通讯协议。</p>\n<h3 id=\"SSE-诞生的核心背景\"><a href=\"#SSE-诞生的核心背景\" class=\"headerlink\" title=\"SSE 诞生的核心背景\"></a>SSE 诞生的核心背景</h3><p>因此，Web 领域迫切需要一种<strong>标准化的、高效的、由浏览器原生支持的</strong>服务器到客户端的单向通信机制。这就是 SSE 诞生的核心背景。</p>\n<p><strong>核心需求：</strong></p>\n<ul>\n<li><strong>简单</strong>：易于服务器和客户端实现。</li>\n<li><strong>高效</strong>：基于 HTTP&#x2F;HTTPS，避免不必要的请求开销。</li>\n<li><strong>标准</strong>：成为 W3C 标准，得到浏览器原生支持。</li>\n<li><strong>自动重连</strong>：内置连接失败后自动重试的机制。</li>\n</ul>\n<p>SSE：真正的服务器推送</p>\n<p><img src=\"/post/SSE/1927caf78d734921afecee347ad56d9b.png\" alt=\"Image 18: Mermaid\"></p>\n<h2 id=\"1-3-SSE-发展历程\"><a href=\"#1-3-SSE-发展历程\" class=\"headerlink\" title=\"1.3 SSE 发展历程\"></a>1.3 SSE 发展历程</h2><p>SSE 的发展是 Web 标准化进程和实时通信需求共同推动的结果。</p>\n<p>下图概述了其关键发展节点：</p>\n<p><img src=\"/post/SSE/99c50040619043488243bd933358b5d1.png\" alt=\"Image 19: Mermaid\"></p>\n<p>让我们对图中的关键阶段进行详细解读：</p>\n<p><strong>1、 诞生背景（2006 年以前）</strong></p>\n<ul>\n<li>Web 早期只有“请求-响应”范式，实时需求（股票、IM、行情）只能靠轮询或长轮询，延迟高、浪费资源。</li>\n<li>Comet（长连接 iframe、jsonp、xhr-streaming 等 Hack 方案）出现，但实现复杂、浏览器兼容性差、占用连接数高。</li>\n<li>业界急需一种“浏览器原生、基于 HTTP、单向服务器推送”的轻量机制。</li>\n</ul>\n<p><strong>2、 概念提出与标准化 (约 2006-2009年)</strong></p>\n<ul>\n<li>SSE 的概念最初作为 <strong>HTML5</strong> 标准的一部分被提出，由 <strong>WHATWG</strong> (Web Hypertext Application Technology Working Group) 和 <strong>W3C</strong> (World Wide Web Consortium) 共同推动。</li>\n<li>其设计思想是定义一个简单的、基于 HTTP 的协议，允许服务器通过一个长连接持续地向客户端发送文本流。</li>\n<li>2006 年，Opera 9 在浏览器里率先实现名为 Server-Sent Events 的实验 API，用 DOM 事件把服务器推送的文本块喂给页面。</li>\n<li>同期 WHATWG HTML5 草案开始收录相关章节，定义了 text&#x2F;event-stream MIME 类型及“event: &#x2F; data:”行协议。</li>\n<li>后来，它从庞大的 HTML5 规范中分离出来，成为了一个独立的 W3C 标准文档。</li>\n<li>2008 年：SSE 被正式写入 HTML5 草案，随后进入 W3C 标准流程。</li>\n</ul>\n<p><strong>3、 浏览器支持与推广 (约 2010-2015年)</strong></p>\n<ul>\n<li><strong>2011年左右</strong>，主流浏览器（如 Firefox、Chrome、Safari、Opera）开始陆续支持 SSE API。 Firefox 6、Chrome 6、Safari 5、Opera 11.5 陆续完成原生实现；IE 系列缺席（直到 Edge 79 才补票）。</li>\n<li><strong>关键的障碍</strong>：<strong>Internet Explorer (包括 IE 11)</strong> 始终没有支持 SSE API。这在一定程度上限制了其早期的广泛应用，开发者通常需要为此准备降级方案（如回落到长轮询）。</li>\n<li>随着 Chrome、Firefox 等现代浏览器的市场份额不断上升，以及移动端浏览器对 SSE 的良好支持，SSE 逐渐成为开发实时 Web 应用的可信选择。</li>\n<li>2014 年 10 月：HTML5 成为 W3C Recommendation，SSE 作为官方子模块锁定最终语法，浏览器阵营格局定型。</li>\n</ul>\n<p><strong>4. 正式推荐与成熟 (2015年至2022 )</strong></p>\n<ul>\n<li><p>2015-2020 年，WebSocket 与 WebRTC 占据实时通信话题中心，SSE 主要在企业内部仪表盘、日志 tail 等低频场景默默使用。</p>\n</li>\n<li><p>SSE 由于有 “单向文本流 + 自动重连 + 轻量” 特性，<strong>所以没有被WebSocket 与 WebRTC 踩死</strong>， 使其在 IoT 设备、移动端 WebView 中仍保有一席之地。</p>\n</li>\n<li><p><strong>2015年</strong>，W3C 发布了 <strong>Server-Sent Events</strong> 的正式推荐标准，标志着该技术的成熟和稳定。</p>\n</li>\n<li><p>在此期间，前端生态框架（如 React、Vue.js）和后端语言（如 Node.js、Python、Java）都提供了对 SSE 的良好支持，出现了大量易用的库和示例。</p>\n</li>\n</ul>\n<p><strong>5、 大模型时代的爆发（2022 至今）</strong></p>\n<ul>\n<li><p>虽然 <strong>WebSocket</strong> 提供了全双工通信能力，但 SSE 因其简单的 API、基于 HTTP 带来的良好兼容性（如无需担心代理或防火墙问题）、以及自动重连等特性，在<strong>只需要服务器向客户端推送数据</strong>的场景中（如新闻推送、实时行情、状态更新、AI 处理进度流式输出等）成为了更简单、更合适的选择。</p>\n</li>\n<li><p>ChatGPT、Claude 等生成式 AI 需要“打字机”式逐 token 输出，SSE 天然契合：</p>\n</li>\n<li><p>基于 HTTP&#x2F;1.1 无需升级协议，CDN 缓存友好；</p>\n</li>\n<li><p>浏览器 EventSource API 一行代码即可接入；</p>\n</li>\n<li><p>文本流可直接承载 JSON Lines 或 markdown 片段。</p>\n</li>\n<li><p>2022 年底起，OpenAI、Anthropic、Google Bard 均把 text&#x2F;event-stream 作为官方流式回答协议，社区库（FastAPI SSE-Star、Spring WebFlux、Node sse.js、Go gin-sse）迎来二次繁荣。</p>\n</li>\n</ul>\n<h2 id=\"1-4、SSE-的主要特点\"><a href=\"#1-4、SSE-的主要特点\" class=\"headerlink\" title=\"1.4、SSE 的主要特点\"></a>1.4、SSE 的主要特点</h2><table>\n<thead>\n<tr>\n<th>特性</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>单向通信</strong></td>\n<td>仅支持服务器向客户端发送数据</td>\n</tr>\n<tr>\n<td><strong>基于 HTTP</strong></td>\n<td>无需升级协议或使用额外端口，兼容现有网络设施</td>\n</tr>\n<tr>\n<td><strong>自动重连</strong></td>\n<td>浏览器在连接断开后可自动重新建立连接</td>\n</tr>\n<tr>\n<td><strong>轻量易用</strong></td>\n<td>浏览器原生支持，API 简洁易懂</td>\n</tr>\n<tr>\n<td><strong>文本流支持</strong></td>\n<td>默认支持 UTF-8 文本，二进制数据需编码后传输</td>\n</tr>\n</tbody></table>\n<p>SSE和WebSocket 都能建立浏览器与服务器的长期通信，但区别很明显：</p>\n<ul>\n<li><strong>SSE</strong> 是单向推送 不是双向推送， 而且是http协议的一个扩展协议， 使用简单、自动重连，适合文本类实时推送。</li>\n<li><strong>WebSocket</strong> 是双向通信，不是 http协议的一个扩展协议，WebSocket 更灵活，但实现相对复杂。</li>\n</ul>\n<p><img src=\"/post/SSE/44e494b057564f0dbc977223c6824ec8.png\" alt=\"Image 20: image-20250828111134857\"></p>\n<p><strong>流程解读：</strong></p>\n<p>1、<strong>连接初始化</strong>：客户端使用特定的 <code>Content-Type: text/event-stream</code> 向服务器发起一个普通的 HTTP GET 请求。服务器确认并保持连接开放。</p>\n<p>2、<strong>数据推送</strong>：服务器通过保持打开的连接，以纯文本格式（遵循 <code>data: ...</code>、<code>event: ...</code> 等规范）持续发送数据块。每个消息以两个换行符 <code>\\n\\n</code> 结束。</p>\n<p>3、<strong>连接容错</strong>：如果连接因网络问题中断，SSE 客户端内置的机制会自动尝试重新建立连接，极大地提高了应用的鲁棒性。</p>\n<p>4、<strong>客户端处理</strong>：浏览器端的 <code>EventSource</code> API 会解析收到的数据流，触发相应的事件（如 <code>onmessage</code> 或自定义事件），让开发者能够处理推送来的数据</p>\n<p>SSE 的诞生是 Web 开发对<strong>简单、高效、标准化</strong>的服务器推送技术需求的直接结果。它有效地替代了笨拙的轮询技术，在与 WebSocket 的竞争中，找到了自身在<strong>单向数据流</strong>场景下的独特定位。</p>\n<p>其发展历程经历了从概念提出、浏览器支持到成为正式标准的完整路径。尽管曾受限于 IE，但在现代浏览器中已成为一项稳定、可靠且被广泛采用的技术。如今，在实时通知、金融仪表盘、实时日志跟踪和大型语言模型（LLM）的流式响应输出等场景中，SSE 都是首选的解决方案。</p>\n<h1 id=\"二：SSE-出来20年才一夜-爆火-，为什么？\"><a href=\"#二：SSE-出来20年才一夜-爆火-，为什么？\" class=\"headerlink\" title=\"二：SSE 出来20年才一夜 爆火 ，为什么？\"></a>二：SSE 出来20年才一夜 爆火 ，为什么？</h1><p><strong>SSE 最近站到聚光灯下，几乎可以说最大的推手就是当前 AI 应用（尤其是 ChatGPT 等大型语言模型）的爆发式增长。</strong></p>\n<p>SSE 之所以成为 AI 应用的“标配”，是因为 SSE 与 AI 所需的“打字机” 输出模式 是 <strong>天作之合</strong>。</p>\n<h2 id=\"2-1-什么是“打字机”-式逐-token-输出？\"><a href=\"#2-1-什么是“打字机”-式逐-token-输出？\" class=\"headerlink\" title=\"2.1 什么是“打字机” 式逐 token 输出？\"></a>2.1 什么是“打字机” 式逐 token 输出？</h2><p>“打字机”式 逐 token 输出是一种<strong>流式传输</strong>方式，它模拟了人类打字或思考的过程。</p>\n<p>服务器不是等待 LLM 生成整个答案 后一次性发送给 用户，而是 流式输出， <strong>每生成一个“词元”（token，可以粗略理解为一个词或一个字），就立刻发送这个“词元”</strong>。</p>\n<p>下面举一个例子，对比 一下 传统方式（非流式）和 “打字机” （流式）式 的过程。</p>\n<p><strong>传统方式（非流式）过程如下：</strong></p>\n<p>1、你提问：“请写一首关于春天的诗”。</p>\n<p>2、服务器端的 AI 开始思考、生成，整个过程你需要等待（可能好几秒甚至更久）。</p>\n<p>3、AI 生成完整的诗歌：“春风拂面绿意浓，百花争艳映晴空…”。</p>\n<p>4、服务器将<strong>整首诗</strong>作为一个完整的 JSON 对象 <code>{ &quot;content&quot;: &quot;春风拂面绿意浓，百花争艳映晴空...&quot; }</code> 发送给客户端。</p>\n<p>5、客户端一次性收到全部内容并渲染出来。</p>\n<p><strong>“打字机”（流式）过程如下：</strong></p>\n<p>1、你提问：“请写一首关于春天的诗”。</p>\n<p>2、服务器端的 AI 生成第一个 token “春”，<strong>立刻</strong>通过 SSE 发送 <code>data: “春”</code>。</p>\n<p>3、客户端收到“春”并显示出来。</p>\n<p>4、AI 生成第二个 token “风”，<strong>立刻</strong>发送 <code>data: “风”</code>。</p>\n<p>5、客户端在“春”后面追加“风”，形成“春风”。</p>\n<p>6、后续 token “拂”、“面”、“绿”、“意”、“浓”… 依次迅速发送和追加。</p>\n<p>7、你看到的效果就是<strong>文字一个接一个地“打”在屏幕上</strong>，就像有人在远端为你实时打字一样。</p>\n<p><strong>“打字机”（流式） 模式的巨大优势：</strong></p>\n<p>1、<strong>极低的感知延迟</strong>：用户几乎在提问后瞬间就能看到第一个字开始输出，无需经历漫长的等待白屏期，体验流畅自然。</p>\n<p>2、<strong>提供了“正在进行”的反馈</strong>：看着文字逐个出现，给人一种模型正在为你“思考”和“创作”的生动感，而不是在“沉默中宕机”。</p>\n<p>3、<strong>更高效地利用时间</strong>：用户可以在前半句还在输出时，就开始阅读和理解，节省了总体的认知时间。</p>\n<h2 id=\"2-2-为什么-SSE-是这种模式的“天作之合”？\"><a href=\"#2-2-为什么-SSE-是这种模式的“天作之合”？\" class=\"headerlink\" title=\"2.2 为什么 SSE 是这种模式的“天作之合”？\"></a>2.2 为什么 SSE 是这种模式的“天作之合”？</h2><p>这正是 SSE 的设计初衷和核心优势所在，它与 AI 流式输出的需求完美匹配：</p>\n<p>1、<strong>单向通信的完美匹配</strong>：</p>\n<p>AI 的文本生成过程本质上是<strong>服务器到客户端的单向数据推送</strong>。</p>\n<p>客户端只需要接收，不需要在生成过程中频繁地发送请求。</p>\n<p>SSE 的“服务器推送”模型正是为此而生，而 WebSocket 的双向能力在这里是多余的。</p>\n<p>2、<strong>基于 HTTP&#x2F;HTTPS，简单且兼容</strong>：</p>\n<p>SSE 使用标准的 HTTP 协议，这意味着 <strong>SSE 易于实现和调试</strong>：任何后端框架和前端语言都能轻松处理。在浏览器中调试时，你可以在“网络”选项卡中直接看到以文本流形式传输的事件，非常直观。</p>\n<p>SSE 使用标准的 HTTP 协议，这还意味着 <strong>容易绕过网络障碍</strong>：公司防火墙和代理通常对 HTTP&#x2F;HTTPS 放行，而可能会阻拦陌生的 WebSocket 协议。这使得 SSE 的部署兼容性极好。</p>\n<p>3、<strong>内置的自动重连机制</strong>：</p>\n<p>网络连接并不完全可靠。</p>\n<p>如果用户在接收很长的回答时网络波动，连接中断，SSE 客户端会自动尝试重新连接。</p>\n<p>这对于长时间流的应用至关重要，提供了天然的鲁棒性。</p>\n<p>4、<strong>轻量级的文本协议</strong>：</p>\n<p>AI 流式输出传输的就是文本（UTF-8编码）。SSE 的协议 <code>data: ...\\n\\n</code> 就是为传输文本片段而设计的，极其高效和简单。</p>\n<p>WebSocket 虽然也能传文本，但其协议设计还考虑了二进制帧、掩码等更复杂的情况，对于纯文本流来说显得有些“重”。</p>\n<p>5、<strong>原生浏览器 API</strong>：</p>\n<p>现代浏览器都原生支持 <code>EventSource</code> API，开发者无需引入额外的第三方库，即可轻松实现接收流式数据，减少了依赖和打包体积。</p>\n<p><img src=\"/post/SSE/2c656cc828824defb2d90014ee478c52.png\" alt=\"Image 21: Mermaid\"></p>\n<p>所以，<strong>SSE 站到聚光灯下的原因正是：</strong></p>\n<p><strong>AI 应用需要“打字机”式的逐 token 输出体验，而 SSE 作为一种基于 HTTP 的、简单的、单向的服务器推送技术，是实现这种体验最自然、最高效、最可靠的技术选择。</strong></p>\n<p>它就像是为这个场景量身定做的工具，没有多余的功能，只有恰到好处的设计。</p>\n<p>因此，当 ChatGPT 等应用席卷全球时，其背后默默无闻的 SSE 技术也终于从幕后走到了台前，被广大开发者所重新认识和重视。</p>\n<h1 id=\"三、SSE-的工作原理\"><a href=\"#三、SSE-的工作原理\" class=\"headerlink\" title=\"三、SSE 的工作原理\"></a>三、SSE 的工作原理</h1><h2 id=\"3-1-工作机制的流程图\"><a href=\"#3-1-工作机制的流程图\" class=\"headerlink\" title=\"3.1 工作机制的流程图\"></a>3.1 工作机制的流程图</h2><p>SSE 通过一个持久的 HTTP 连接实现服务器到客户端的单向数据流。</p>\n<p>以下是其工作机制的流程图：</p>\n<p><img src=\"/post/SSE/cecdb8d8baf24c488c2e6f4f21d40a5e.png\" alt=\"Image 22: image-20250828131435779\"></p>\n<p><strong>关键步骤解析：</strong></p>\n<p><strong>1、浏览器发起一个 HTTP 请求，Header 中包含：</strong></p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">Accept:</span> <span class=\"keyword\">text</span>/<span class=\"keyword\">event</span>-stream</span><br></pre></td></tr></table></figure>\n\n<p><strong>2、服务器响应类型必须为：</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Content-Type:</span> <span class=\"string\">text/event-stream</span></span><br><span class=\"line\"><span class=\"attr\">Cache-Control:</span> <span class=\"literal\">no</span><span class=\"string\">-cache</span></span><br><span class=\"line\"><span class=\"attr\">Connection:</span> <span class=\"string\">keep-alive</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>3、服务器发送事件格式（每个事件以两个换行符结束）：</strong></p>\n<figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">event:</span> message</span><br><span class=\"line\"><span class=\"symbol\">data:</span> &#123;<span class=\"string\">&quot;time&quot;</span>: <span class=\"string\">&quot;2023-10-05T12:00:00&quot;</span>, <span class=\"string\">&quot;value&quot;</span>: <span class=\"string\">&quot;New update!&quot;</span>&#125;</span><br><span class=\"line\"><span class=\"symbol\">id:</span> <span class=\"number\">12345</span></span><br><span class=\"line\"><span class=\"symbol\">retry:</span> <span class=\"number\">5000</span></span><br><span class=\"line\">\\n\\n</span><br></pre></td></tr></table></figure>\n\n<p><strong>4、浏览器通过 <code>EventSource</code>API 接收并处理事件。</strong></p>\n<p><strong>5、服务器发送 一个特殊“结束”事件，可以结束传输。</strong></p>\n<p>比如，服务器发送一个如 <code>event: end</code> 的消息，可以结束传输。</p>\n<p>客户端预先监听这个自定义的 <code>end</code> 事件，一旦收到，就知道传输结束，并可以<strong>选择主动关闭 EventSource 连接</strong>。</p>\n<p><strong>6、若连接中断，浏览器会根据 <code>retry</code>字段自动重连。</strong></p>\n<p>如果没有收到 特殊“结束”事件， 浏览器 可以自动重连。</p>\n<h2 id=\"3-2、SSE-与其他通信方式对比\"><a href=\"#3-2、SSE-与其他通信方式对比\" class=\"headerlink\" title=\"3.2、SSE 与其他通信方式对比\"></a>3.2、SSE 与其他通信方式对比</h2><p>不同通信技术各有适用场景，我们用表格清晰对比：</p>\n<table>\n<thead>\n<tr>\n<th>技术</th>\n<th>通信方向</th>\n<th>基于协议</th>\n<th>复杂度</th>\n<th>适用场景</th>\n<th>浏览器原生支持</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>轮询（Polling）</td>\n<td>客户端→服务器</td>\n<td>HTTP</td>\n<td>简单</td>\n<td>数据更新频率低（如定时查邮件）</td>\n<td>全部</td>\n</tr>\n<tr>\n<td>长轮询（Long Polling）</td>\n<td>客户端→服务器</td>\n<td>HTTP</td>\n<td>中等</td>\n<td>低频但需实时（如即时消息提醒）</td>\n<td>全部</td>\n</tr>\n<tr>\n<td>SSE</td>\n<td>服务器→客户端</td>\n<td>HTTP</td>\n<td>简单</td>\n<td>持续单向推送（如实时日志、股价、chartGPT）</td>\n<td>（除IE）</td>\n</tr>\n<tr>\n<td>WebSocket</td>\n<td>双向</td>\n<td>自定义协议</td>\n<td>复杂</td>\n<td>互动性强（如在线游戏、视频聊天）</td>\n<td>全部</td>\n</tr>\n</tbody></table>\n<p>简单说：</p>\n<ul>\n<li>只需服务器”说话”选SSE</li>\n<li>需要双方”对话”选WebSocket</li>\n<li>偶尔查一次数据选轮询&#x2F;长轮询</li>\n</ul>\n<h2 id=\"3-3-SSE-的适用场景\"><a href=\"#3-3-SSE-的适用场景\" class=\"headerlink\" title=\"3.3 SSE 的适用场景\"></a>3.3 SSE 的适用场景</h2><p><strong>1、ChatGPT 式逐字输出( “打字机” 式逐 词元 token输出)</strong></p>\n<p><img src=\"/post/SSE/ac3887ce3546479a8ff1fe5a7027643f.png\" alt=\"Image 23: image-20250828131743395\"></p>\n<p><strong>2、实时通知系统</strong></p>\n<ul>\n<li>新订单提醒</li>\n<li>用户消息推送</li>\n<li>审核状态更新</li>\n</ul>\n<p><strong>3、实时数据看板</strong></p>\n<ul>\n<li>股票行情</li>\n<li>设备监控数据</li>\n<li>实时日志流</li>\n</ul>\n<h1 id=\"四、sse-客户端-API-详解\"><a href=\"#四、sse-客户端-API-详解\" class=\"headerlink\" title=\"四、sse 客户端 API 详解\"></a>四、sse 客户端 API 详解</h1><p>SSE的客户端实现非常简单，浏览器原生提供了<code>EventSource</code>对象来处理与服务器的SSE连接。下面我们详细介绍它的使用方法和核心特性。</p>\n<h2 id=\"4-1、认识-浏览器-EventSource对象\"><a href=\"#4-1、认识-浏览器-EventSource对象\" class=\"headerlink\" title=\"4.1、认识 浏览器 EventSource对象\"></a>4.1、认识 浏览器 EventSource对象</h2><h3 id=\"浏览器兼容性检测\"><a href=\"#浏览器兼容性检测\" class=\"headerlink\" title=\"浏览器兼容性检测\"></a>浏览器兼容性检测</h3><p>在使用SSE前，首先需要确认当前浏览器是否支持<code>EventSource</code>（除IE&#x2F;Edge外，几乎所有现代浏览器都支持）。检测方法如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 检查浏览器是否支持SSE</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;EventSource&#x27;</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">window</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 支持SSE，可正常使用</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;浏览器支持SSE&#x27;</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 不支持SSE，需降级处理</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;浏览器不支持SSE&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建连接\"><a href=\"#创建连接\" class=\"headerlink\" title=\"创建连接\"></a>创建连接</h3><p>使用<code>EventSource</code>创建与服务器的连接非常简单，只需传入服务器的SSE接口地址：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 建立与服务器的SSE连接</span></span><br><span class=\"line\"><span class=\"comment\">// url为服务器提供的SSE接口地址（可同域或跨域）</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> source = <span class=\"keyword\">new</span> <span class=\"title class_\">EventSource</span>(url);</span><br></pre></td></tr></table></figure>\n\n<p>如果需要跨域请求并携带Cookie，可通过第二个参数配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 跨域请求时，允许携带Cookie</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> source = <span class=\"keyword\">new</span> <span class=\"title class_\">EventSource</span>(url, &#123; </span><br><span class=\"line\">  <span class=\"attr\">withCredentials</span>: <span class=\"literal\">true</span>  <span class=\"comment\">// 默认为false，设为true表示跨域请求携带Cookie</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"连接状态（readyState）\"><a href=\"#连接状态（readyState）\" class=\"headerlink\" title=\"连接状态（readyState）\"></a>连接状态（readyState）</h3><p><code>EventSource</code>实例的<code>readyState</code>属性用于表示当前连接状态，只读且有三个可能值：</p>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>常量对应</th>\n<th>含义说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>EventSource.CONNECTING</td>\n<td>连接未建立，或断线后正在重连</td>\n</tr>\n<tr>\n<td>1</td>\n<td>EventSource.OPEN</td>\n<td>连接已建立，可正常接收服务器推送的数据</td>\n</tr>\n<tr>\n<td>2</td>\n<td>EventSource.CLOSED</td>\n<td>连接已关闭，且不会自动重连</td>\n</tr>\n</tbody></table>\n<p>可以通过该属性判断当前连接状态，例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (source.<span class=\"property\">readyState</span> === <span class=\"title class_\">EventSource</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;SSE连接已正常建立&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-2、基本使用方法\"><a href=\"#4-2、基本使用方法\" class=\"headerlink\" title=\"4.2、基本使用方法\"></a>4.2、基本使用方法</h2><p><code>EventSource</code>通过事件机制处理连接过程中的各种状态和接收的数据，核心事件包括<code>open</code>、<code>message</code>、<code>error</code>。</p>\n<p>下面用流程图展示SSE客户端的完整使用流程：</p>\n<p><img src=\"/post/SSE/292bd236fc4042b3aff73c6a19f1b16e.png\" alt=\"Image 24: Mermaid\"></p>\n<h3 id=\"连接建立：open事件\"><a href=\"#连接建立：open事件\" class=\"headerlink\" title=\"连接建立：open事件\"></a>连接建立：open事件</h3><p>当客户端与服务器成功建立SSE连接时，会触发<code>open</code>事件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 方式1：使用onopen属性</span></span><br><span class=\"line\">source.<span class=\"property\">onopen</span> = <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;SSE连接已建立&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 可在此处做连接成功后的初始化操作，如更新UI状态</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方式2：使用addEventListener（推荐，可添加多个回调）</span></span><br><span class=\"line\">source.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;open&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;SSE连接已建立（监听方式）&#x27;</span>);</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"接收数据：message事件\"><a href=\"#接收数据：message事件\" class=\"headerlink\" title=\"接收数据：message事件\"></a>接收数据：message事件</h3><p>当客户端收到服务器推送的数据时，会触发<code>message</code>事件（默认事件，处理未指定类型的消息）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 方式1：使用onmessage属性</span></span><br><span class=\"line\">source.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// event.data为服务器推送的文本数据</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = event.<span class=\"property\">data</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;收到数据：&#x27;</span>, data);</span><br><span class=\"line\">  <span class=\"comment\">// 可在此处处理数据，如更新页面内容</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方式2：使用addEventListener</span></span><br><span class=\"line\">source.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = event.<span class=\"property\">data</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;收到数据（监听方式）：&#x27;</span>, data);</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意：<code>event.data</code>始终是字符串类型，如果服务器发送的是JSON数据，需要用<code>JSON.parse(data)</code>转换。</p></blockquote>\n<h3 id=\"连接错误：error事件\"><a href=\"#连接错误：error事件\" class=\"headerlink\" title=\"连接错误：error事件\"></a>连接错误：error事件</h3><p>当连接发生错误（如网络中断、服务器出错）时，会触发<code>error</code>事件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 方式1：使用onerror属性</span></span><br><span class=\"line\">source.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 可根据readyState判断错误类型</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (source.<span class=\"property\">readyState</span> === <span class=\"title class_\">EventSource</span>.<span class=\"property\">CONNECTING</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;连接出错，正在尝试重连...&#x27;</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;连接已关闭，无法重连&#x27;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 方式2：使用addEventListener</span></span><br><span class=\"line\">source.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 错误处理逻辑</span></span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关闭连接：close-方法\"><a href=\"#关闭连接：close-方法\" class=\"headerlink\" title=\"关闭连接：close()方法\"></a>关闭连接：close()方法</h3><p>如果需要主动关闭SSE连接（关闭后不会自动重连），可调用<code>close()</code>方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 主动关闭SSE连接</span></span><br><span class=\"line\">source.<span class=\"title function_\">close</span>();</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;SSE连接已手动关闭&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3、自定义事件\"><a href=\"#4-3、自定义事件\" class=\"headerlink\" title=\"4.3、自定义事件\"></a>4.3、自定义事件</h2><p>默认情况下，服务器推送的消息会触发<code>message</code>事件。</p>\n<p>但实际开发中，我们可能需要区分不同类型的消息（如”新订单通知”和”系统公告”），这时就可以使用<strong>自定义事件</strong>。</p>\n<p>客户端通过<code>addEventListener</code>监听自定义事件名，例如监听<code>order</code>事件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 监听名为&quot;order&quot;的自定义事件</span></span><br><span class=\"line\">source.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;order&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> orderData = event.<span class=\"property\">data</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;收到新订单：&#x27;</span>, orderData);</span><br><span class=\"line\">  <span class=\"comment\">// 处理订单相关逻辑</span></span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 再监听一个名为&quot;notice&quot;的自定义事件</span></span><br><span class=\"line\">source.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;notice&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> noticeData = event.<span class=\"property\">data</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;收到系统公告：&#x27;</span>, noticeData);</span><br><span class=\"line\">  <span class=\"comment\">// 处理公告相关逻辑</span></span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意：自定义事件不会触发<code>message</code>事件，只会被对应的<code>addEventListener</code>捕获。</p>\n<p>上面代码中，浏览器对 SSE 的<code>foo``notice</code>事件进行监听。如何实现服务器发送<code>foo``notice</code>事件，请看下文。</p></blockquote>\n<h1 id=\"五、SSE服务器实现：数据格式与规则\"><a href=\"#五、SSE服务器实现：数据格式与规则\" class=\"headerlink\" title=\"五、SSE服务器实现：数据格式与规则\"></a>五、SSE服务器实现：数据格式与规则</h1><p>服务器要实现SSE，核心是按照特定格式向客户端发送数据。</p>\n<p>下面详细介绍服务器端的实现规范。</p>\n<h2 id=\"5-1-HTTP-头信息要求\"><a href=\"#5-1-HTTP-头信息要求\" class=\"headerlink\" title=\"5.1 HTTP 头信息要求\"></a>5.1 HTTP 头信息要求</h2><p>服务器向客户端发送SSE数据时，必须设置以下HTTP响应头，否则客户端无法正确识别为事件流：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Content-Type</span><span class=\"punctuation\">: </span>text/event-stream  // 必须，指定为事件流类型</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>no-cache          // 必须，禁止缓存，确保数据实时性</span><br><span class=\"line\"><span class=\"attribute\">Connection</span><span class=\"punctuation\">: </span>keep-alive           // 必须，保持长连接</span><br></pre></td></tr></table></figure>\n\n<p>这三个头信息是SSE的基础，缺少任何一个都可能导致连接失败或数据异常。</p>\n<h2 id=\"5-2-数据传输格式\"><a href=\"#5-2-数据传输格式\" class=\"headerlink\" title=\"5.2 数据传输格式\"></a>5.2 数据传输格式</h2><p>服务器发送的每条消息（message）由多行组成，每行格式为<code>[字段]: 值\\n</code>（字段名后必须跟冒号和空格，结尾用换行符<code>\\n</code>）。</p>\n<p>多条消息之间用<code>\\n\\n</code>（两个换行符）分隔。</p>\n<p>此外，以<code>:</code>开头的行是注释（服务器可定期发送注释保持连接）。</p>\n<p><strong>基本格式示例</strong></p>\n<figure class=\"highlight haskell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: 这是一条注释（客户端会忽略）\\n</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">data</span>: 这是第一条消息\\n\\n</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">data</span>: 这是第二条消息的第一行\\n</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">data</span>: 这是第二条消息的第二行\\n\\n</span></span><br></pre></td></tr></table></figure>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意：换行符必须是<code>\\n</code>（Unix格式），<code>\\r\\n</code>可能导致客户端解析错误。</p></blockquote>\n<h2 id=\"5-3-核心字段说明\"><a href=\"#5-3-核心字段说明\" class=\"headerlink\" title=\"5.3 核心字段说明\"></a>5.3 核心字段说明</h2><p>SSE消息支持四个核心字段，分别用于不同场景：</p>\n<h3 id=\"1-data字段：消息内容\"><a href=\"#1-data字段：消息内容\" class=\"headerlink\" title=\"1. data字段：消息内容\"></a>1. data字段：消息内容</h3><p><code>data</code>字段用于携带实际的消息内容，是最常用的字段。</p>\n<ul>\n<li>单行数据：</li>\n</ul>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">data</span>: Hello, SSE!\\n\\n  <span class=\"comment\">// 单行数据，以\\n\\n结束</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>多行数据（适合JSON等复杂结构）：</li>\n</ul>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">data</span>: &#123;\\n               <span class=\"comment\">// 第一行以\\n结束</span></span><br><span class=\"line\"><span class=\"keyword\">data</span>: <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;张三&quot;</span>,\\n  <span class=\"comment\">// 第二行以\\n结束</span></span><br><span class=\"line\"><span class=\"keyword\">data</span>: <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">20</span>\\n        <span class=\"comment\">// 第三行以\\n结束</span></span><br><span class=\"line\"><span class=\"keyword\">data</span>: &#125;\\n\\n              <span class=\"comment\">// 最后一行以\\n\\n结束</span></span><br></pre></td></tr></table></figure>\n\n<p>客户端接收后，<code>event.data</code>会自动拼接为完整字符串：<code>{&quot;name&quot;: &quot;张三&quot;,&quot;age&quot;: 20}</code></p>\n<h3 id=\"2-event字段：指定事件类型\"><a href=\"#2-event字段：指定事件类型\" class=\"headerlink\" title=\"2. event字段：指定事件类型\"></a>2. event字段：指定事件类型</h3><p><code>event</code>字段用于指定消息的事件类型，客户端可通过对应事件名监听（即3.3节的自定义事件）。</p>\n<p>服务器发送：</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">event</span>: order\\n           <span class=\"comment\">// 指定事件类型为order</span></span><br><span class=\"line\">data: 新订单ID：<span class=\"number\">12345</span>\\n   <span class=\"comment\">// 消息内容</span></span><br><span class=\"line\">\\n                       <span class=\"comment\">// 消息结束（\\n\\n简化为单独一行）</span></span><br></pre></td></tr></table></figure>\n\n<p>客户端监听：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;order&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(event.<span class=\"property\">data</span>);  <span class=\"comment\">// 输出：新订单ID：12345</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-id字段：消息标识\"><a href=\"#3-id字段：消息标识\" class=\"headerlink\" title=\"3. id字段：消息标识\"></a>3. id字段：消息标识</h3><p><code>id</code>字段用于给消息设置唯一标识，客户端会自动记录最后一条消息的<code>id</code>（存于<code>source.lastEventId</code>）。</p>\n<p><strong>核心作用</strong>：当连接断线重连时，客户端会在请求头中携带<code>Last-Event-ID: [最后收到的id]</code>，服务器可根据该ID恢复数据传输（避免重复或丢失）。</p>\n<p>服务器发送：</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id: msg1001\\n            <span class=\"comment\">// 消息标识</span></span><br><span class=\"line\"><span class=\"keyword\">data</span>: 这是第<span class=\"number\">1001</span>条消息\\n</span><br><span class=\"line\">\\n</span><br></pre></td></tr></table></figure>\n\n<p>客户端重连时的请求头：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Last-Event-ID</span><span class=\"punctuation\">: </span>msg1001  // 自动携带最后收到的id</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-retry字段：重连间隔\"><a href=\"#4-retry字段：重连间隔\" class=\"headerlink\" title=\"4. retry字段：重连间隔\"></a>4. retry字段：重连间隔</h3><p><code>retry</code>字段用于指定客户端断线后的重连间隔（单位：毫秒），默认重连间隔约为3秒。</p>\n<p>服务器发送：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">retry:</span> <span class=\"number\">5000</span><span class=\"string\">\\n</span>            <span class=\"string\">//</span> <span class=\"string\">告诉客户端，断线后5秒再重连</span></span><br><span class=\"line\"><span class=\"attr\">data:</span> <span class=\"string\">重连间隔已设置为5秒\\n</span></span><br><span class=\"line\"><span class=\"string\">\\n</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-服务器保持连接示例\"><a href=\"#5-服务器保持连接示例\" class=\"headerlink\" title=\"5. 服务器保持连接示例\"></a>5. 服务器保持连接示例</h3><p>服务器可以定期发送注释行，保持连接活跃：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">:</span> <span class=\"string\">这是保持连接活动的注释行\\n</span></span><br><span class=\"line\"><span class=\"string\">:</span> <span class=\"string\">服务器时间</span> <span class=\"number\">2023-10-05T12:00:00</span><span class=\"string\">\\n</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-4-服务器发送流程\"><a href=\"#5-4-服务器发送流程\" class=\"headerlink\" title=\"5.4 服务器发送流程\"></a>5.4 服务器发送流程</h2><p>服务器发送SSE数据的完整流程如下：</p>\n<p><img src=\"/post/SSE/daace7683c264776b2c227eb0dcd85d9.png\" alt=\"Image 25: Mermaid\"></p>\n<p>下面是一个包含多种字段的服务器发送示例，模拟一个实时通知系统：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">:</span> <span class=\"string\">服务器开始发送消息（注释）\\n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">id:</span> <span class=\"number\">1001</span><span class=\"string\">\\n</span></span><br><span class=\"line\"><span class=\"attr\">event:</span> <span class=\"string\">notice\\n</span></span><br><span class=\"line\"><span class=\"attr\">data:</span> <span class=\"string\">系统将在10分钟后维护\\n\\n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">id:</span> <span class=\"number\">1002</span><span class=\"string\">\\n</span></span><br><span class=\"line\"><span class=\"attr\">event:</span> <span class=\"string\">order\\n</span></span><br><span class=\"line\"><span class=\"attr\">data:</span> &#123;<span class=\"attr\">&quot;orderId&quot;:</span> <span class=\"string\">&quot;20230501&quot;</span>, <span class=\"attr\">&quot;status&quot;:</span> <span class=\"string\">&quot;paid&quot;</span>&#125;<span class=\"string\">\\n\\n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">retry:</span> <span class=\"number\">10000</span><span class=\"string\">\\n</span></span><br><span class=\"line\"><span class=\"attr\">id:</span> <span class=\"number\">1003</span><span class=\"string\">\\n</span></span><br><span class=\"line\"><span class=\"attr\">data:</span> <span class=\"string\">重连间隔已调整为10秒\\n\\n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">:</span> <span class=\"string\">这是保持连接活动的注释行\\n</span></span><br><span class=\"line\"><span class=\"string\">:</span> <span class=\"string\">服务器时间</span> <span class=\"number\">2023-10-05T12:00:00</span><span class=\"string\">\\n</span></span><br></pre></td></tr></table></figure>\n\n<p>客户端接收后：</p>\n<ul>\n<li><code>notice</code>事件会捕获到”系统将在10分钟后维护”</li>\n<li><code>order</code>事件会捕获到订单JSON数据</li>\n<li>重连间隔被设置为10秒</li>\n<li>最后收到的消息ID是1003（断线重连时会携带）</li>\n</ul>\n<p>通过以上规范，服务器就能轻松实现SSE功能，向客户端实时推送数据。</p>\n<p>相比WebSocket，SSE的服务器实现更简单，无需处理复杂的协议握手，只需按格式发送文本数据即可。</p>\n<h1 id=\"六、SSE实战案例：用Spring-Boot搭建实时通信系统\"><a href=\"#六、SSE实战案例：用Spring-Boot搭建实时通信系统\" class=\"headerlink\" title=\"六、SSE实战案例：用Spring Boot搭建实时通信系统\"></a>六、SSE实战案例：用Spring Boot搭建实时通信系统</h1><p>接下来， 通过一个完整案例 手把手教你用Spring Boot实现SSE功能。</p>\n<p>这个案例包含服务端（后端）和客户端（前端）代码， 可以直接运行体验服务器主动推送数据的效果。</p>\n<h2 id=\"6-1、案例整体架构\"><a href=\"#6-1、案例整体架构\" class=\"headerlink\" title=\"6.1、案例整体架构\"></a>6.1、案例整体架构</h2><p>我们要实现的系统包含三个核心部分：</p>\n<ul>\n<li>后端服务：基于Spring Boot，提供SSE连接接口、消息广播接口和任务进度推送接口</li>\n<li>前端页面：一个简单的HTML页面，通过<code>EventSource</code>与后端建立SSE连接</li>\n<li>交互流程：客户端连接后，可接收服务器主动推送的连接状态、广播消息和任务进度</li>\n</ul>\n<p>整体架构流程图：</p>\n<p><img src=\"/post/SSE/6b117ea347364b83ade67a3cedb3c163.png\" alt=\"Image 26: Mermaid\"></p>\n<h2 id=\"6-2、服务端实现\"><a href=\"#6-2、服务端实现\" class=\"headerlink\" title=\"6.2、服务端实现\"></a>6.2、服务端实现</h2><h3 id=\"6-2-1-准备依赖\"><a href=\"#6-2-1-准备依赖\" class=\"headerlink\" title=\"6.2.1 准备依赖\"></a>6.2.1 准备依赖</h3><p>首先创建Spring Boot项目，在<code>pom.xml</code>中添加以下依赖（用于web开发和页面渲染）：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Spring Web：提供SSE相关类和HTTP服务 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Thymeleaf：用于渲染前端页面 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这些依赖是基础：<code>spring-boot-starter-web</code>提供了SSE核心类<code>SseEmitter</code>，<code>spring-boot-starter-thymeleaf</code>用于将HTML页面返回给浏览器。</p>\n<h3 id=\"6-2-2-编写SSE核心控制器\"><a href=\"#6-2-2-编写SSE核心控制器\" class=\"headerlink\" title=\"6.2.2 编写SSE核心控制器\"></a>6.2.2 编写SSE核心控制器</h3><p>创建<code>SseController</code>，这是服务端处理SSE连接和消息推送的核心类：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.sse.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.MediaType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.mvc.method.annotation.SseEmitter;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SseController</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 存储所有活跃的SSE连接（线程安全的列表）</span></span><br><span class=\"line\">    <span class=\"comment\">// CopyOnWriteArrayList适合读多写少场景，避免并发问题</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> CopyOnWriteArrayList&lt;SseEmitter&gt; emitters = <span class=\"keyword\">new</span> <span class=\"title class_\">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 线程池：用于异步发送事件，避免阻塞主线程</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">ExecutorService</span> <span class=\"variable\">executor</span> <span class=\"operator\">=</span> Executors.newCachedThreadPool();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 客户端订阅SSE的接口</span></span><br><span class=\"line\"><span class=\"comment\">     * 客户端通过访问该接口建立长连接，接收服务器推送的事件</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/sse/subscribe&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SseEmitter <span class=\"title function_\">subscribe</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 创建SseEmitter实例，设置超时时间为无限（默认30秒会超时，这里设为Long.MAX_VALUE避免自动断开）</span></span><br><span class=\"line\">        <span class=\"type\">SseEmitter</span> <span class=\"variable\">emitter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SseEmitter</span>(Long.MAX_VALUE);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 将新连接加入活跃列表（后续推送消息时会遍历这个列表）</span></span><br><span class=\"line\">        emitters.add(emitter);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 设置连接完成/超时的回调：从活跃列表中移除该连接，释放资源</span></span><br><span class=\"line\">        emitter.onCompletion(() -&gt; emitters.remove(emitter)); <span class=\"comment\">// 连接正常关闭时</span></span><br><span class=\"line\">        emitter.onTimeout(() -&gt; emitters.remove(emitter));     <span class=\"comment\">// 连接超时关闭时</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 发送初始连接成功消息（给客户端的&quot;欢迎消息&quot;）</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            emitter.send(SseEmitter.event()</span><br><span class=\"line\">                    .name(<span class=\"string\">&quot;CONNECTED&quot;</span>)  <span class=\"comment\">// 事件名称：客户端可通过&quot;CONNECTED&quot;事件监听</span></span><br><span class=\"line\">                    .data(<span class=\"string\">&quot;You are successfully connected to SSE server!&quot;</span>)  <span class=\"comment\">// 消息内容</span></span><br><span class=\"line\">                    .reconnectTime(<span class=\"number\">5000</span>)); <span class=\"comment\">// 告诉客户端：如果断开连接，5秒后重连</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 发送失败时，标记连接异常结束</span></span><br><span class=\"line\">            emitter.completeWithError(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> emitter; <span class=\"comment\">// 将emitter返回给客户端，保持连接</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 广播消息接口：向所有已连接的客户端推送消息</span></span><br><span class=\"line\"><span class=\"comment\">     * 可通过浏览器访问 http://localhost:8080/sse/broadcast?message=xxx 触发</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/sse/broadcast&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">broadcastMessage</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String message)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 用线程池异步执行广播，避免阻塞当前请求</span></span><br><span class=\"line\">        executor.execute(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 遍历所有活跃连接，逐个发送消息</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (SseEmitter emitter : emitters) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    emitter.send(SseEmitter.event()</span><br><span class=\"line\">                            .name(<span class=\"string\">&quot;BROADCAST&quot;</span>)  <span class=\"comment\">// 事件名称：客户端监听&quot;BROADCAST&quot;事件</span></span><br><span class=\"line\">                            .data(message)      <span class=\"comment\">// 广播的消息内容</span></span><br><span class=\"line\">                            .id(String.valueOf(System.currentTimeMillis()))); <span class=\"comment\">// 消息ID（用于重连时定位）</span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 发送失败（可能客户端已断开），从列表中移除并标记连接结束</span></span><br><span class=\"line\">                    emitters.remove(emitter);</span><br><span class=\"line\">                    emitter.completeWithError(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Broadcast message: &quot;</span> + message; <span class=\"comment\">// 给调用者的响应</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 模拟长时间任务：向客户端推送实时进度</span></span><br><span class=\"line\"><span class=\"comment\">     * 适合文件上传、数据处理等需要实时反馈进度的场景</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/sse/start-task&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">startTask</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 异步执行任务，避免阻塞当前请求</span></span><br><span class=\"line\">        executor.execute(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 模拟任务进度：从0%到100%，每次增加10%</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt;= <span class=\"number\">100</span>; i += <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>); <span class=\"comment\">// 休眠1秒，模拟处理耗时</span></span><br><span class=\"line\">                    </span><br><span class=\"line\">                    <span class=\"comment\">// 向所有客户端推送当前进度</span></span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (SseEmitter emitter : emitters) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                            emitter.send(SseEmitter.event()</span><br><span class=\"line\">                                    .name(<span class=\"string\">&quot;PROGRESS&quot;</span>)  <span class=\"comment\">// 事件名称：客户端监听&quot;PROGRESS&quot;事件</span></span><br><span class=\"line\">                                    .data(i + <span class=\"string\">&quot;% completed&quot;</span>)  <span class=\"comment\">// 进度数据</span></span><br><span class=\"line\">                                    .id(<span class=\"string\">&quot;task-progress&quot;</span>)); <span class=\"comment\">// 固定ID，标识这是任务进度消息</span></span><br><span class=\"line\">                        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                            <span class=\"comment\">// 发送失败，移除连接</span></span><br><span class=\"line\">                            emitters.remove(emitter);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    <span class=\"comment\">// 任务完成时，发送结束消息</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (i == <span class=\"number\">100</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> (SseEmitter emitter : emitters) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                                emitter.send(SseEmitter.event()</span><br><span class=\"line\">                                        .name(<span class=\"string\">&quot;COMPLETE&quot;</span>)  <span class=\"comment\">// 事件名称：客户端监听&quot;COMPLETE&quot;事件</span></span><br><span class=\"line\">                                        .data(<span class=\"string\">&quot;Task completed successfully!&quot;</span>));</span><br><span class=\"line\">                            &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                                emitters.remove(emitter);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 任务被中断时，恢复线程中断状态并退出</span></span><br><span class=\"line\">                Thread.currentThread().interrupt();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Task started!&quot;</span>; <span class=\"comment\">// 告诉调用者任务已启动</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"核心代码说明：\"><a href=\"#核心代码说明：\" class=\"headerlink\" title=\"核心代码说明：\"></a>核心代码说明：</h4><ul>\n<li><code>SseEmitter</code>：Spring提供的SSE核心类，每个实例对应一个客户端连接</li>\n<li><code>emitters</code>列表：管理所有活跃连接，方便广播消息（类似”客户端注册表”）</li>\n<li><code>executor</code>线程池：异步处理消息发送，避免阻塞主线程（如果同步发送，一个客户端卡住会影响所有用户）</li>\n<li>事件发送：通过<code>emitter.send(SseEmitter.event())</code>构建消息，可指定事件名、数据、ID和重连时间</li>\n</ul>\n<h3 id=\"6-2-3-编写页面控制器\"><a href=\"#6-2-3-编写页面控制器\" class=\"headerlink\" title=\"6.2.3 编写页面控制器\"></a>6.2.3 编写页面控制器</h3><p>创建<code>PageController</code>，用于将前端页面返回给浏览器：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.sse.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Controller;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Controller</span> <span class=\"comment\">// 注意这里用@Controller而非@RestController，用于返回页面</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PageController</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 访问根路径时，返回SSE客户端页面</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">index</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 返回src/main/resources/templates目录下的sse-client.html</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;sse-client&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-3、客户端实现（HTML页面）\"><a href=\"#6-3、客户端实现（HTML页面）\" class=\"headerlink\" title=\"6.3、客户端实现（HTML页面）\"></a>6.3、客户端实现（HTML页面）</h2><p>在<code>src/main/resources/templates</code>目录下创建<code>sse-client.html</code>，这是用户交互的前端页面：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">xmlns:th</span>=<span class=\"string\">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SSE Client Example<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123; <span class=\"attribute\">font-family</span>: Arial, sans-serif; <span class=\"attribute\">margin</span>: <span class=\"number\">40px</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123; <span class=\"attribute\">max-width</span>: <span class=\"number\">800px</span>; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>; <span class=\"attribute\">margin</span>: <span class=\"number\">5px</span> <span class=\"number\">0</span>; <span class=\"attribute\">border-left</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ccc</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.broadcast</span> &#123; <span class=\"attribute\">border-color</span>: <span class=\"number\">#4CAF50</span>; <span class=\"attribute\">background-color</span>: <span class=\"number\">#E8F5E9</span>; &#125; <span class=\"comment\">/* 广播消息：绿色边框 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.progress</span> &#123; <span class=\"attribute\">border-color</span>: <span class=\"number\">#2196F3</span>; <span class=\"attribute\">background-color</span>: <span class=\"number\">#E3F2FD</span>; &#125;   <span class=\"comment\">/* 进度消息：蓝色边框 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.complete</span> &#123; <span class=\"attribute\">border-color</span>: <span class=\"number\">#FF9800</span>; <span class=\"attribute\">background-color</span>: <span class=\"number\">#FFF3E0</span>; &#125;   <span class=\"comment\">/* 完成消息：橙色边框 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.error</span> &#123; <span class=\"attribute\">border-color</span>: <span class=\"number\">#F44336</span>; <span class=\"attribute\">background-color</span>: <span class=\"number\">#FFEBEE</span>; &#125;       <span class=\"comment\">/* 错误消息：红色边框 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">button</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">15px</span>; <span class=\"attribute\">margin</span>: <span class=\"number\">5px</span>; <span class=\"attribute\">cursor</span>: pointer; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Server-Sent Events (SSE) Client<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 操作按钮区 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;connectSSE()&quot;</span>&gt;</span>Connect to SSE<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span>    <span class=\"comment\">&lt;!-- 建立SSE连接 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;disconnectSSE()&quot;</span>&gt;</span>Disconnect<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span>     <span class=\"comment\">&lt;!-- 断开连接 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;broadcastMessage()&quot;</span>&gt;</span>Send Broadcast<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> <span class=\"comment\">&lt;!-- 发送广播 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;startTask()&quot;</span>&gt;</span>Start Task<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span>         <span class=\"comment\">&lt;!-- 启动模拟任务 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 消息展示区 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>Messages:<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> <span class=\"comment\">&lt;!-- 动态显示服务器推送的消息 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> eventSource = <span class=\"literal\">null</span>; <span class=\"comment\">// 用于存储SSE连接实例（全局变量）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        </span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">/**</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         * 建立SSE连接</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">function</span> <span class=\"title function_\">connectSSE</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 避免重复连接</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (eventSource) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Already connected to SSE&quot;</span>, <span class=\"string\">&quot;error&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 创建EventSource实例，连接服务端的SSE接口</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource = <span class=\"keyword\">new</span> <span class=\"title class_\">EventSource</span>(<span class=\"string\">&#x27;/sse/subscribe&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 连接成功建立时触发</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"property\">onopen</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Connection established&quot;</span>, <span class=\"string\">&quot;complete&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 监听未指定事件名的消息（对应服务端未设置name的事件）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Message: &quot;</span> + event.<span class=\"property\">data</span>, <span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 监听服务端发送的&quot;CONNECTED&quot;事件（连接成功通知）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;CONNECTED&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Connected: &quot;</span> + event.<span class=\"property\">data</span>, <span class=\"string\">&quot;complete&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 监听服务端发送的&quot;BROADCAST&quot;事件（广播消息）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;BROADCAST&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Broadcast: &quot;</span> + event.<span class=\"property\">data</span>, <span class=\"string\">&quot;broadcast&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 监听服务端发送的&quot;PROGRESS&quot;事件（任务进度）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;PROGRESS&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Progress: &quot;</span> + event.<span class=\"property\">data</span>, <span class=\"string\">&quot;progress&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 监听服务端发送的&quot;COMPLETE&quot;事件（任务完成）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;COMPLETE&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Complete: &quot;</span> + event.<span class=\"property\">data</span>, <span class=\"string\">&quot;complete&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            </span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 连接出错时触发（如网络中断）</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            eventSource.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Error occurred&quot;</span>, <span class=\"string\">&quot;error&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 注意：SSE会自动重连，无需手动处理</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        </span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">/**</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         * 断开SSE连接</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">function</span> <span class=\"title function_\">disconnectSSE</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (eventSource) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                eventSource.<span class=\"title function_\">close</span>(); <span class=\"comment\">// 关闭连接</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                eventSource = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Disconnected from SSE&quot;</span>, <span class=\"string\">&quot;complete&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Not connected to SSE&quot;</span>, <span class=\"string\">&quot;error&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        </span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">/**</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         * 发送广播消息（调用服务端的广播接口）</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">function</span> <span class=\"title function_\">broadcastMessage</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">const</span> message = <span class=\"title function_\">prompt</span>(<span class=\"string\">&quot;Enter message to broadcast:&quot;</span>); <span class=\"comment\">// 弹出输入框</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (message) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 调用后端广播接口</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;/sse/broadcast?message=&#x27;</span> + <span class=\"built_in\">encodeURIComponent</span>(message))</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    .<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> response.<span class=\"title function_\">text</span>())</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    .<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Server: &quot;</span> + data, <span class=\"string\">&quot;message&quot;</span>))</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    .<span class=\"title function_\">catch</span>(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Error: &quot;</span> + error, <span class=\"string\">&quot;error&quot;</span>));</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        </span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">/**</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         * 启动模拟任务（调用服务端的任务接口）</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">function</span> <span class=\"title function_\">startTask</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;/sse/start-task&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                .<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> response.<span class=\"title function_\">text</span>())</span></span><br><span class=\"line\"><span class=\"language-javascript\">                .<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Server: &quot;</span> + data, <span class=\"string\">&quot;message&quot;</span>))</span></span><br><span class=\"line\"><span class=\"language-javascript\">                .<span class=\"title function_\">catch</span>(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> <span class=\"title function_\">addMessage</span>(<span class=\"string\">&quot;Error: &quot;</span> + error, <span class=\"string\">&quot;error&quot;</span>));</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        </span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">/**</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         * 在页面上添加消息（辅助函数）</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">         */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">function</span> <span class=\"title function_\">addMessage</span>(<span class=\"params\">text, className</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">const</span> messagesDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;messages&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">const</span> messageDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            messageDiv.<span class=\"property\">className</span> = <span class=\"string\">&#x27;message &#x27;</span> + className; <span class=\"comment\">// 添加样式类</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 显示时间和消息内容</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            messageDiv.<span class=\"property\">textContent</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleTimeString</span>() + <span class=\"string\">&#x27; - &#x27;</span> + text;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            messagesDiv.<span class=\"title function_\">appendChild</span>(messageDiv);</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 自动滚动到最新消息</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            messagesDiv.<span class=\"property\">scrollTop</span> = messagesDiv.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"客户端核心逻辑：\"><a href=\"#客户端核心逻辑：\" class=\"headerlink\" title=\"客户端核心逻辑：\"></a>客户端核心逻辑：</h4><ul>\n<li><code>eventSource</code>：<code>EventSource</code>实例，是客户端与服务端SSE连接的”桥梁”</li>\n<li>事件监听：通过<code>addEventListener</code>监听服务端定义的事件（<code>CONNECTED</code>&#x2F;<code>BROADCAST</code>等）</li>\n<li>自动重连：当连接断开时，<code>EventSource</code>会自动重试（无需手动写重连逻辑）</li>\n<li>交互函数：<code>connectSSE</code>&#x2F;<code>disconnectSSE</code>等函数对应页面按钮，实现用户操作</li>\n</ul>\n<h2 id=\"6-4、运行与测试\"><a href=\"#6-4、运行与测试\" class=\"headerlink\" title=\"6.4、运行与测试\"></a>6.4、运行与测试</h2><h3 id=\"6-4-1-启动步骤\"><a href=\"#6-4-1-启动步骤\" class=\"headerlink\" title=\"6.4.1 启动步骤\"></a>6.4.1 启动步骤</h3><p>1、 确保Spring Boot项目配置正确（默认端口8080，无需额外配置）</p>\n<p> 2、 启动Spring Boot应用（运行带有<code>main</code>方法的启动类）</p>\n<p> 3、 打开浏览器，访问 <code>http://localhost:8080/</code>，看到客户端页面</p>\n<h3 id=\"6-4-2-功能测试\"><a href=\"#6-4-2-功能测试\" class=\"headerlink\" title=\"6.4.2 功能测试\"></a>6.4.2 功能测试</h3><p><strong>1、建立连接</strong>：点击”Connect to SSE”按钮，页面会显示”连接成功”的消息（服务端通过<code>CONNECTED</code>事件推送）</p>\n<p><strong>2、发送广播</strong>：点击”Send Broadcast”按钮，输入任意消息（如”Hello SSE”），页面会显示广播消息（服务端向所有连接的客户端推送）</p>\n<p><strong>3、启动任务</strong>：点击”Start Task”按钮，页面会每秒收到一条进度消息（从0%到100%），最后显示”任务完成”</p>\n<p><strong>4、断开连接</strong>：点击”Disconnect”按钮，连接关闭，不再接收消息</p>\n<h3 id=\"4-3-测试流程图\"><a href=\"#4-3-测试流程图\" class=\"headerlink\" title=\"4.3 测试流程图\"></a>4.3 测试流程图</h3><p><img src=\"/post/SSE/e4d7a803ae4b435ab4631d501fb75b88.png\" alt=\"Image 27: Mermaid\"></p>\n<h2 id=\"6-5、-服务端-关键技术点\"><a href=\"#6-5、-服务端-关键技术点\" class=\"headerlink\" title=\"6.5、 服务端 关键技术点\"></a>6.5、 服务端 关键技术点</h2><p><strong>1、SseEmitter的作用</strong>：Spring封装的SSE工具类，简化了”保持连接+发送事件”的实现，无需手动处理HTTP流格式。</p>\n<p><strong>2、连接管理</strong>：用<code>CopyOnWriteArrayList</code>存储活跃连接，确保线程安全；通过<code>onCompletion</code>&#x2F;<code>onTimeout</code>回调清理无效连接，避免内存泄漏。</p>\n<p><strong>3、异步处理</strong>：必须用线程池（<code>ExecutorService</code>）异步发送消息，否则会阻塞主线程，导致新请求无法处理。</p>\n<p><strong>4、事件设计</strong>：通过<code>name</code>区分不同类型的事件（如<code>PROGRESS</code>&#x2F;<code>BROADCAST</code>），客户端按需监听，逻辑更清晰。</p>\n<p><strong>5、自动重连</strong>：SSE客户端（<code>EventSource</code>）内置重连机制，网络恢复后会自动重新连接，无需额外代码。</p>\n<p>通过这个案例，你可以清晰看到SSE的优势：实现简单（几行代码就能建立实时连接）、无需额外协议（基于HTTP）、自带重连机制。如果你的场景只需要服务器单向推送数据（如实时通知、进度更新），SSE会是比WebSocket更轻量的选择。</p>\n","feature":true,"text":"一、什么是SSE？SSE为何突然爆火？你有没有想过，为什么 ChatGPT 的回答能逐字逐句地“流”出来？ 这一切的背后，都离不开一项关键技术——SSE（Ser...","permalink":"/post/SSE","photos":[],"count_time":{"symbolsCount":"27k","symbolsTime":"25 mins."},"categories":[{"name":"SpringBoot","slug":"SpringBoot","count":10,"path":"api/categories/SpringBoot.json"},{"name":"通信技术","slug":"SpringBoot/通信技术","count":1,"path":"api/categories/SpringBoot/通信技术.json"}],"tags":[{"name":"JAVA","slug":"JAVA","count":1,"path":"api/tags/JAVA.json"},{"name":"SSE","slug":"SSE","count":1,"path":"api/tags/SSE.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFSSE%EF%BC%9FSSE%E4%B8%BA%E4%BD%95%E7%AA%81%E7%84%B6%E7%88%86%E7%81%AB%EF%BC%9F\"><span class=\"toc-text\">一、什么是SSE？SSE为何突然爆火？</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-SSE%EF%BC%9F\"><span class=\"toc-text\">1.1、什么是 SSE？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-2-SSE-Server-Sent-Events-%E8%AF%9E%E7%94%9F%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">1.2 SSE (Server-Sent Events) 诞生背景</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9F%AD%E8%BD%AE%E8%AF%A2%E3%80%81%E9%95%BF%E8%BD%AE%E8%AF%A2%E3%80%81Flash-%E3%80%81-WebSocket\"><span class=\"toc-text\">短轮询、长轮询、Flash 、 WebSocket</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SSE-%E8%AF%9E%E7%94%9F%E7%9A%84%E6%A0%B8%E5%BF%83%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">SSE 诞生的核心背景</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-3-SSE-%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B\"><span class=\"toc-text\">1.3 SSE 发展历程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-4%E3%80%81SSE-%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9\"><span class=\"toc-text\">1.4、SSE 的主要特点</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C%EF%BC%9ASSE-%E5%87%BA%E6%9D%A520%E5%B9%B4%E6%89%8D%E4%B8%80%E5%A4%9C-%E7%88%86%E7%81%AB-%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F\"><span class=\"toc-text\">二：SSE 出来20年才一夜 爆火 ，为什么？</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-1-%E4%BB%80%E4%B9%88%E6%98%AF%E2%80%9C%E6%89%93%E5%AD%97%E6%9C%BA%E2%80%9D-%E5%BC%8F%E9%80%90-token-%E8%BE%93%E5%87%BA%EF%BC%9F\"><span class=\"toc-text\">2.1 什么是“打字机” 式逐 token 输出？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-2-%E4%B8%BA%E4%BB%80%E4%B9%88-SSE-%E6%98%AF%E8%BF%99%E7%A7%8D%E6%A8%A1%E5%BC%8F%E7%9A%84%E2%80%9C%E5%A4%A9%E4%BD%9C%E4%B9%8B%E5%90%88%E2%80%9D%EF%BC%9F\"><span class=\"toc-text\">2.2 为什么 SSE 是这种模式的“天作之合”？</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81SSE-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">三、SSE 的工作原理</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-1-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE\"><span class=\"toc-text\">3.1 工作机制的流程图</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-2%E3%80%81SSE-%E4%B8%8E%E5%85%B6%E4%BB%96%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94\"><span class=\"toc-text\">3.2、SSE 与其他通信方式对比</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-3-SSE-%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">3.3 SSE 的适用场景</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E3%80%81sse-%E5%AE%A2%E6%88%B7%E7%AB%AF-API-%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\">四、sse 客户端 API 详解</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-1%E3%80%81%E8%AE%A4%E8%AF%86-%E6%B5%8F%E8%A7%88%E5%99%A8-EventSource%E5%AF%B9%E8%B1%A1\"><span class=\"toc-text\">4.1、认识 浏览器 EventSource对象</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">浏览器兼容性检测</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">创建连接</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81%EF%BC%88readyState%EF%BC%89\"><span class=\"toc-text\">连接状态（readyState）</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-2%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">4.2、基本使用方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%EF%BC%9Aopen%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">连接建立：open事件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE%EF%BC%9Amessage%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">接收数据：message事件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9E%E6%8E%A5%E9%94%99%E8%AF%AF%EF%BC%9Aerror%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">连接错误：error事件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%EF%BC%9Aclose-%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">关闭连接：close()方法</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-3%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">4.3、自定义事件</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%94%E3%80%81SSE%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0%EF%BC%9A%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E4%B8%8E%E8%A7%84%E5%88%99\"><span class=\"toc-text\">五、SSE服务器实现：数据格式与规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-1-HTTP-%E5%A4%B4%E4%BF%A1%E6%81%AF%E8%A6%81%E6%B1%82\"><span class=\"toc-text\">5.1 HTTP 头信息要求</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-2-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">5.2 数据传输格式</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-3-%E6%A0%B8%E5%BF%83%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">5.3 核心字段说明</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-data%E5%AD%97%E6%AE%B5%EF%BC%9A%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">1. data字段：消息内容</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-event%E5%AD%97%E6%AE%B5%EF%BC%9A%E6%8C%87%E5%AE%9A%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">2. event字段：指定事件类型</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-id%E5%AD%97%E6%AE%B5%EF%BC%9A%E6%B6%88%E6%81%AF%E6%A0%87%E8%AF%86\"><span class=\"toc-text\">3. id字段：消息标识</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-retry%E5%AD%97%E6%AE%B5%EF%BC%9A%E9%87%8D%E8%BF%9E%E9%97%B4%E9%9A%94\"><span class=\"toc-text\">4. retry字段：重连间隔</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%9D%E6%8C%81%E8%BF%9E%E6%8E%A5%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">5. 服务器保持连接示例</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-4-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">5.4 服务器发送流程</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%85%AD%E3%80%81SSE%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%94%A8Spring-Boot%E6%90%AD%E5%BB%BA%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%E7%B3%BB%E7%BB%9F\"><span class=\"toc-text\">六、SSE实战案例：用Spring Boot搭建实时通信系统</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-1%E3%80%81%E6%A1%88%E4%BE%8B%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84\"><span class=\"toc-text\">6.1、案例整体架构</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-2%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">6.2、服务端实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-2-1-%E5%87%86%E5%A4%87%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">6.2.1 准备依赖</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-2-2-%E7%BC%96%E5%86%99SSE%E6%A0%B8%E5%BF%83%E6%8E%A7%E5%88%B6%E5%99%A8\"><span class=\"toc-text\">6.2.2 编写SSE核心控制器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E8%AF%B4%E6%98%8E%EF%BC%9A\"><span class=\"toc-text\">核心代码说明：</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-2-3-%E7%BC%96%E5%86%99%E9%A1%B5%E9%9D%A2%E6%8E%A7%E5%88%B6%E5%99%A8\"><span class=\"toc-text\">6.2.3 编写页面控制器</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-3%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88HTML%E9%A1%B5%E9%9D%A2%EF%BC%89\"><span class=\"toc-text\">6.3、客户端实现（HTML页面）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91%EF%BC%9A\"><span class=\"toc-text\">客户端核心逻辑：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-4%E3%80%81%E8%BF%90%E8%A1%8C%E4%B8%8E%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">6.4、运行与测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-4-1-%E5%90%AF%E5%8A%A8%E6%AD%A5%E9%AA%A4\"><span class=\"toc-text\">6.4.1 启动步骤</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-4-2-%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">6.4.2 功能测试</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-3-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B%E5%9B%BE\"><span class=\"toc-text\">4.3 测试流程图</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-5%E3%80%81-%E6%9C%8D%E5%8A%A1%E7%AB%AF-%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E7%82%B9\"><span class=\"toc-text\">6.5、 服务端 关键技术点</span></a></li></ol></li></ol>","author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"VueUse Head","uid":"0c1a486237cc0ded727f0473b33c5eab","slug":"VueUse-Head","date":"2025-11-13T05:29:50.000Z","updated":"2025-11-13T05:31:25.860Z","comments":true,"path":"api/articles/VueUse-Head.json","keywords":"VUE、Python、JAVA","cover":"/medias/VueUse_Head.png","text":"VueUse Head 使用教程项目 介绍VueUse Head 是一个用于管理 Vue 3 应用中 <head> 标签内容的库。它允许开发者动态地设置和更新文...","permalink":"/post/VueUse-Head","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"前端","slug":"前端","count":2,"path":"api/categories/前端.json"}],"tags":[{"name":"vue","slug":"vue","count":2,"path":"api/tags/vue.json"},{"name":"插件","slug":"插件","count":3,"path":"api/tags/插件.json"}],"author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"feature":true},"next_post":{"title":"agent","uid":"6c03615222d1e2ccb10d78d4232256eb","slug":"agent","date":"2025-11-12T05:59:06.000Z","updated":"2025-11-12T06:01:45.423Z","comments":true,"path":"api/articles/agent.json","keywords":"VUE、Python、JAVA","cover":"/medias/agent.png","text":"一、什么是智能体？智能体（Agent）是一个能够感知环境、进行推理、制定计划、做出决策并自主采取行动以实现特定目标的 AI 系统。它以大语言模型为核心，集成 记...","permalink":"/post/agent","photos":[],"count_time":{"symbolsCount":"37k","symbolsTime":"34 mins."},"categories":[{"name":"SpringBoot","slug":"SpringBoot","count":10,"path":"api/categories/SpringBoot.json"},{"name":"Spring AI","slug":"SpringBoot/Spring-AI","count":8,"path":"api/categories/SpringBoot/Spring-AI.json"}],"tags":[{"name":"Spring AI","slug":"Spring-AI","count":9,"path":"api/tags/Spring-AI.json"},{"name":"大模型","slug":"大模型","count":9,"path":"api/tags/大模型.json"},{"name":"AI","slug":"AI","count":8,"path":"api/tags/AI.json"}],"author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>怀民亦未寝</span><span style='font-size:30px;'>💕</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"feature":true}}