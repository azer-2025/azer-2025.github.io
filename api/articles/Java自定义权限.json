{"title":"Javaè‡ªå®šä¹‰æƒé™","uid":"2ce8b034845753ca77c49afec1ffd79e","slug":"Javaè‡ªå®šä¹‰æƒé™","date":"2025-11-28T02:31:40.000Z","updated":"2025-11-28T14:32:10.408Z","comments":true,"path":"api/articles/Javaè‡ªå®šä¹‰æƒé™.json","keywords":"VUEã€Pythonã€JAVA","cover":"/medias/quanxian.png","content":"<h3 id=\"0-å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ\"><a href=\"#0-å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ\" class=\"headerlink\" title=\"0.å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ\"></a>0.å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ</h3><p>å¯ä»¥å°†æ¥å£åˆ†ä¸º 4 ç§æƒé™ï¼š</p>\n<ol>\n<li>æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨</li>\n<li>ç™»å½•ç”¨æˆ·æ‰èƒ½ä½¿ç”¨</li>\n<li>æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç™»å½•ç”¨æˆ·èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼ˆæ¯”å¦‚ç™»å½•åæŸ¥çœ‹å…¨æ–‡ï¼‰</li>\n<li>ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨</li>\n</ol>\n<p>ä¼ ç»Ÿçš„æƒé™æ§åˆ¶æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªæ¥å£å†…å•ç‹¬ç¼–å†™é€»è¾‘ï¼šå…ˆè·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­ç”¨æˆ·çš„æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚</p>\n<p>è¿™ç§æ–¹æ³•æœ€çµæ´»ï¼Œä½†æ˜¯ä¼šå†™å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œè€Œä¸”å…¶ä»–å¼€å‘è€…æ— æ³•ä¸€çœ¼å¾—çŸ¥æ¥å£æ‰€éœ€è¦çš„æƒé™ã€‚</p>\n<p>æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£ ** å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚</p>\n<p>ğŸ’¡ å¦‚æœéœ€è¦æ›´å¤æ‚æ›´çµæ´»çš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥å¼•å…¥ Shiro &#x2F; Spring Security &#x2F; Sa-Token ç­‰ä¸“é—¨çš„æƒé™ç®¡ç†æ¡†æ¶ã€‚</p>\n<h3 id=\"1-æšä¸¾ç±»\"><a href=\"#1-æšä¸¾ç±»\" class=\"headerlink\" title=\"1.æšä¸¾ç±»\"></a>1.æšä¸¾ç±»</h3><p>å¯¹äºç”¨æˆ·è§’è‰²è¿™æ ·å€¼çš„æ•°é‡æœ‰é™çš„ã€å¯æšä¸¾çš„å­—æ®µï¼Œæœ€å¥½å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä¾¿äºåœ¨é¡¹ç›®ä¸­è·å–å€¼ã€å‡å°‘æšä¸¾å€¼è¾“å…¥é”™è¯¯çš„æƒ…å†µã€‚</p>\n<p>åœ¨ <code>model.enums</code> åŒ…ä¸‹æ–°å»º UserRoleEnumï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Getter</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">UserRoleEnum</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    USER(<span class=\"string\">&quot;ç”¨æˆ·&quot;</span>, <span class=\"string\">&quot;user&quot;</span>),</span><br><span class=\"line\">    ADMIN(<span class=\"string\">&quot;ç®¡ç†å‘˜&quot;</span>, <span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String value;</span><br><span class=\"line\"></span><br><span class=\"line\">    UserRoleEnum(String text, String value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.text = text;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> UserRoleEnum <span class=\"title function_\">getEnumByValue</span><span class=\"params\">(String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ObjUtil.isEmpty(value)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (UserRoleEnum anEnum : UserRoleEnum.values()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (anEnum.value.equals(value)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> anEnum;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶ä¸­ï¼ŒgetEnumByValue æ˜¯é€šè¿‡ value æ‰¾åˆ°å…·ä½“çš„æšä¸¾å¯¹è±¡ã€‚</p>\n<p>ğŸ’¡ å¦‚æœæšä¸¾å€¼ç‰¹åˆ«å¤šï¼Œå¯ä»¥ Map ç¼“å­˜æ‰€æœ‰æšä¸¾å€¼æ¥åŠ é€ŸæŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯éå†åˆ—è¡¨ã€‚</p>\n<h3 id=\"2-è·å–å½“å‰ç™»å½•ç”¨æˆ·\"><a href=\"#2-è·å–å½“å‰ç™»å½•ç”¨æˆ·\" class=\"headerlink\" title=\"2.è·å–å½“å‰ç™»å½•ç”¨æˆ·\"></a>2.è·å–å½“å‰ç™»å½•ç”¨æˆ·</h3><p>å¯ä»¥ä» request è¯·æ±‚å¯¹è±¡å¯¹åº”çš„ Session ä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚</p>\n<h4 id=\"1ã€æœåŠ¡å¼€å‘\"><a href=\"#1ã€æœåŠ¡å¼€å‘\" class=\"headerlink\" title=\"1ã€æœåŠ¡å¼€å‘\"></a>1ã€æœåŠ¡å¼€å‘</h4><p>åœ¨ <code>service</code> åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User <span class=\"title function_\">getLoginUser</span><span class=\"params\">(HttpServletRequest request)</span>;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ UserServiceImpl ä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ­¤å¤„ä¸ºäº†ä¿è¯è·å–åˆ°çš„æ•°æ®å§‹ç»ˆæ˜¯æœ€æ–°çš„ï¼Œå…ˆä» Session ä¸­è·å–ç™»å½•ç”¨æˆ·çš„ idï¼Œç„¶åä»æ•°æ®åº“ä¸­æŸ¥è¯¢æœ€æ–°çš„ç»“æœã€‚ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> User <span class=\"title function_\">getLoginUser</span><span class=\"params\">(HttpServletRequest request)</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">userObj</span> <span class=\"operator\">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">currentUser</span> <span class=\"operator\">=</span> (User) userObj;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (currentUser == <span class=\"literal\">null</span> || currentUser.getId() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BusinessException</span>(ErrorCode.NOT_LOGIN_ERROR);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"variable\">userId</span> <span class=\"operator\">=</span> currentUser.getId();</span><br><span class=\"line\">    currentUser = <span class=\"built_in\">this</span>.getById(userId);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (currentUser == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BusinessException</span>(ErrorCode.NOT_LOGIN_ERROR);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentUser;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2ã€æ¥å£å¼€å‘\"><a href=\"#2ã€æ¥å£å¼€å‘\" class=\"headerlink\" title=\"2ã€æ¥å£å¼€å‘\"></a>2ã€æ¥å£å¼€å‘</h4><p>åœ¨ UserController ä¸­æ–°å¢è·å–å½“å‰ç™»å½•ç”¨æˆ·æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/get/login&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> BaseResponse&lt;LoginUserVO&gt; <span class=\"title function_\">getLoginUser</span><span class=\"params\">(HttpServletRequest request)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">loginUser</span> <span class=\"operator\">=</span> userService.getLoginUser(request);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ResultUtils.success(userService.getLoginUserVO(loginUser));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ç›´æ¥å°†æ•°æ®åº“æŸ¥åˆ°çš„æ‰€æœ‰ä¿¡æ¯éƒ½è¿”å›ç»™äº†å‰ç«¯ï¼ˆåŒ…æ‹¬å¯†ç ï¼‰ï¼Œå¯èƒ½å­˜åœ¨ä¿¡æ¯æ³„éœ²çš„å®‰å…¨é£é™©ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¿”å›ç»“æœè¿›è¡Œè„±æ•å¤„ç†ã€‚</p>\n<h4 id=\"3ã€æ•°æ®è„±æ•\"><a href=\"#3ã€æ•°æ®è„±æ•\" class=\"headerlink\" title=\"3ã€æ•°æ®è„±æ•\"></a>3ã€æ•°æ®è„±æ•</h4><p>åœ¨ <code>model.vo</code> åŒ…ä¸‹æ–°å»º <code>LoginUserVO</code> ç±»ï¼Œè¡¨ç¤ºè„±æ•åçš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LoginUserVO</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long id;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userAccount;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userAvatar;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userProfile;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userRole;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date createTime;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date updateTime;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">serialVersionUID</span> <span class=\"operator\">=</span> <span class=\"number\">1L</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ UserService ä¸­æ–°å¢è·å–è„±æ•åçš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LoginUserVO <span class=\"title function_\">getLoginUserVO</span><span class=\"params\">(User user)</span>;</span><br></pre></td></tr></table></figure>\n\n<p>ç¼–å†™æ–¹æ³•å¯¹åº”çš„å®ç°ç±»ï¼Œå…¶å®å°±æ˜¯å°† User ç±»çš„å±æ€§å¤åˆ¶åˆ° LoginUserVO ä¸­ï¼Œä¸å­˜åœ¨çš„å­—æ®µå°±è¢«è¿‡æ»¤æ‰äº†ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> LoginUserVO <span class=\"title function_\">getLoginUserVO</span><span class=\"params\">(User user)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (user == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">LoginUserVO</span> <span class=\"variable\">loginUserVO</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LoginUserVO</span>();</span><br><span class=\"line\">    BeanUtils.copyProperties(user, loginUserVO);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> loginUserVO;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ Controller çš„ getLoginUser æ¥å£ï¼Œæ”¹ä¸ºè¿”å›è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/get/login&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> BaseResponse&lt;LoginUserVO&gt; <span class=\"title function_\">getLoginUser</span><span class=\"params\">(HttpServletRequest request)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getLoginUser(request);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ResultUtils.success(userService.getLoginUserVO(user));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-ç”¨æˆ·æƒé™æ§åˆ¶\"><a href=\"#3-ç”¨æˆ·æƒé™æ§åˆ¶\" class=\"headerlink\" title=\"3.ç”¨æˆ·æƒé™æ§åˆ¶\"></a>3.ç”¨æˆ·æƒé™æ§åˆ¶</h3><p>åœ¨æœ¬èŠ‚æ•™ç¨‹çš„æ–¹æ¡ˆè®¾è®¡ä¸­è®²åˆ°ï¼šæƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£ ** å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚</p>\n<h4 id=\"1ã€æƒé™æ ¡éªŒæ³¨è§£\"><a href=\"#1ã€æƒé™æ ¡éªŒæ³¨è§£\" class=\"headerlink\" title=\"1ã€æƒé™æ ¡éªŒæ³¨è§£\"></a>1ã€æƒé™æ ¡éªŒæ³¨è§£</h4><p>é¦–å…ˆç¼–å†™æƒé™æ ¡éªŒæ³¨è§£ï¼Œæ”¾åˆ° <code>annotation</code> åŒ…ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.METHOD)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> AuthCheck &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    String <span class=\"title function_\">mustRole</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2ã€æƒé™æ ¡éªŒåˆ‡é¢\"><a href=\"#2ã€æƒé™æ ¡éªŒåˆ‡é¢\" class=\"headerlink\" title=\"2ã€æƒé™æ ¡éªŒåˆ‡é¢\"></a>2ã€æƒé™æ ¡éªŒåˆ‡é¢</h4><p>ç¼–å†™æƒé™æ ¡éªŒ AOPï¼Œé‡‡ç”¨ç¯ç»•é€šçŸ¥ï¼Œåœ¨ ** æ‰“ä¸Šè¯¥æ³¨è§£çš„æ–¹æ³• ** æ‰§è¡Œå‰åè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚æ ¡éªŒæƒé™ã€‚</p>\n<p>ä»£ç å¦‚ä¸‹ï¼Œæ”¾åˆ° <code>aop</code> åŒ…ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AuthInterceptor</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Around(&quot;@annotation(authCheck)&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">doInterceptor</span><span class=\"params\">(ProceedingJoinPoint joinPoint, AuthCheck authCheck)</span> <span class=\"keyword\">throws</span> Throwable &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">mustRole</span> <span class=\"operator\">=</span> authCheck.mustRole();</span><br><span class=\"line\">        <span class=\"type\">RequestAttributes</span> <span class=\"variable\">requestAttributes</span> <span class=\"operator\">=</span> RequestContextHolder.currentRequestAttributes();</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> ((ServletRequestAttributes) requestAttributes).getRequest();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">loginUser</span> <span class=\"operator\">=</span> userService.getLoginUser(request);</span><br><span class=\"line\">        <span class=\"type\">UserRoleEnum</span> <span class=\"variable\">mustRoleEnum</span> <span class=\"operator\">=</span> UserRoleEnum.getEnumByValue(mustRole);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mustRoleEnum == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> joinPoint.proceed();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"type\">UserRoleEnum</span> <span class=\"variable\">userRoleEnum</span> <span class=\"operator\">=</span> UserRoleEnum.getEnumByValue(loginUser.getUserRole());</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (userRoleEnum == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (UserRoleEnum.ADMIN.equals(mustRoleEnum) &amp;&amp; !UserRoleEnum.ADMIN.equals(userRoleEnum)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> joinPoint.proceed();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3ã€ä½¿ç”¨æ³¨è§£\"><a href=\"#3ã€ä½¿ç”¨æ³¨è§£\" class=\"headerlink\" title=\"3ã€ä½¿ç”¨æ³¨è§£\"></a>3ã€ä½¿ç”¨æ³¨è§£</h4><p>åªè¦ç»™æ–¹æ³•æ·»åŠ äº† @AuthCheck æ³¨è§£ï¼Œå°±å¿…é¡»è¦ç™»å½•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<p>å¯ä»¥è®¾ç½® mustRole ä¸ºç®¡ç†å‘˜ï¼Œè¿™æ ·ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨è¯¥æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯¹äºä¸éœ€è¦ç™»å½•å°±èƒ½ä½¿ç”¨çš„æ¥å£ï¼Œä¸éœ€è¦ä½¿ç”¨è¯¥æ³¨è§£ã€‚</p>\n","text":"0.å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿå¯ä»¥å°†æ¥å£åˆ†ä¸º 4 ç§æƒé™ï¼š æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ ç™»å½•ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç™»å½•ç”¨æˆ·èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼ˆæ¯”å¦‚ç™»å½•åæŸ¥çœ‹å…¨æ–‡ï¼‰...","permalink":"/post/Javaè‡ªå®šä¹‰æƒé™","photos":[],"count_time":{"symbolsCount":"5.4k","symbolsTime":"5 mins."},"categories":[{"name":"SpringBoot","slug":"SpringBoot","count":12,"path":"api/categories/SpringBoot.json"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","count":5,"path":"api/tags/SpringBoot.json"},{"name":"Java","slug":"Java","count":5,"path":"api/tags/Java.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0-%E5%A6%82%E4%BD%95%E5%AF%B9%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E8%BF%9B%E8%A1%8C%E6%8E%A7%E5%88%B6%EF%BC%9F\"><span class=\"toc-text\">0.å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E6%9E%9A%E4%B8%BE%E7%B1%BB\"><span class=\"toc-text\">1.æšä¸¾ç±»</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7\"><span class=\"toc-text\">2.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1%E3%80%81%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\"><span class=\"toc-text\">1ã€æœåŠ¡å¼€å‘</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2%E3%80%81%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91\"><span class=\"toc-text\">2ã€æ¥å£å¼€å‘</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3%E3%80%81%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F\"><span class=\"toc-text\">3ã€æ•°æ®è„±æ•</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6\"><span class=\"toc-text\">3.ç”¨æˆ·æƒé™æ§åˆ¶</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1%E3%80%81%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3\"><span class=\"toc-text\">1ã€æƒé™æ ¡éªŒæ³¨è§£</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2%E3%80%81%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%E5%88%87%E9%9D%A2\"><span class=\"toc-text\">2ã€æƒé™æ ¡éªŒåˆ‡é¢</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3%E3%80%81%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3\"><span class=\"toc-text\">3ã€ä½¿ç”¨æ³¨è§£</span></a></li></ol></li></ol>","author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>æ€€æ°‘äº¦æœªå¯</span><span style='font-size:30px;'>ğŸ’•</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"COSå¯¹è±¡å­˜å‚¨(1)","uid":"8f722d5b594dd13d1364a74f4c91a90a","slug":"COSå¯¹è±¡å­˜å‚¨-1","date":"2025-11-30T13:55:28.000Z","updated":"2025-11-30T13:59:50.522Z","comments":true,"path":"api/articles/COSå¯¹è±¡å­˜å‚¨-1.json","keywords":"VUEã€Pythonã€JAVA","cover":"/medias/cos1.png","text":"ğŸ’¡ å¯¹è±¡å­˜å‚¨ç­‰ç¬¬ä¸‰æ–¹äº‘æœåŠ¡é€šå¸¸æ˜¯ä»˜è´¹åŠŸèƒ½ï¼ŒæŒ‰ç…§å­˜å‚¨é‡ã€æµé‡ç­‰æ–¹å¼è®¡è´¹ã€‚ä¸è¿‡å¯¹äºå¤§å®¶å­¦ä¹ æ¥è¯´ï¼Œç”±äºå›¾ç‰‡å­˜å‚¨é‡å’Œè®¿é—®é‡ä¸å¤§ï¼Œä»·æ ¼éå¸¸ä¾¿å®œï¼ˆå‡ å…ƒ ~ å‡ åå…ƒï¼‰ï¼Œè€Œä¸”è¿˜...","permalink":"/post/COSå¯¹è±¡å­˜å‚¨-1","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"å¯¹è±¡å­˜å‚¨","slug":"å¯¹è±¡å­˜å‚¨","count":2,"path":"api/categories/å¯¹è±¡å­˜å‚¨.json"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","count":5,"path":"api/tags/SpringBoot.json"},{"name":"Java","slug":"Java","count":5,"path":"api/tags/Java.json"},{"name":"å¯¹è±¡å­˜å‚¨","slug":"å¯¹è±¡å­˜å‚¨","count":2,"path":"api/tags/å¯¹è±¡å­˜å‚¨.json"},{"name":"æ’ä»¶","slug":"æ’ä»¶","count":5,"path":"api/tags/æ’ä»¶.json"}],"author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>æ€€æ°‘äº¦æœªå¯</span><span style='font-size:30px;'>ğŸ’•</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}},"feature":true},"next_post":{"title":"Javaè‡ªå®šä¹‰å¼‚å¸¸","uid":"f4466a2d93e9c1012aaf7d67fa2e7507","slug":"Javaè‡ªå®šä¹‰å¼‚å¸¸","date":"2025-11-27T06:27:07.000Z","updated":"2025-11-28T02:36:03.104Z","comments":true,"path":"api/articles/Javaè‡ªå®šä¹‰å¼‚å¸¸.json","keywords":"VUEã€Pythonã€JAVA","cover":"/medias/tongyong.png","text":"Java è‡ªå®šä¹‰å¼‚å¸¸ï¼šæ·±å…¥ç†è§£ä¸å®è·µåœ¨ Java ç¼–ç¨‹ä¸­ï¼Œå¼‚å¸¸å¤„ç†æ˜¯ç¡®ä¿ç¨‹åºå¥å£®æ€§å’Œç¨³å®šæ€§çš„é‡è¦éƒ¨åˆ†ã€‚Java å†…ç½®äº†ä¸°å¯Œçš„å¼‚å¸¸ç±»æ¥å¤„ç†å„ç§å¸¸è§é”™è¯¯æƒ…å†µï¼Œä¾‹å¦‚ ...","permalink":"/post/Javaè‡ªå®šä¹‰å¼‚å¸¸","photos":[],"count_time":{"symbolsCount":"8.8k","symbolsTime":"8 mins."},"categories":[{"name":"SpringBoot","slug":"SpringBoot","count":12,"path":"api/categories/SpringBoot.json"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","count":5,"path":"api/tags/SpringBoot.json"},{"name":"Java","slug":"Java","count":5,"path":"api/tags/Java.json"}],"author":{"name":"Azer","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>æ€€æ°‘äº¦æœªå¯</span><span style='font-size:30px;'>ğŸ’•</span>","socials":{"github":"https://github.com/azer-2025","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_52541129?type=blog","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/1764589563?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/azzzer"}}}}}}